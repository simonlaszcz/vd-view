"use strict";function browserifyModule(n,t){return browserify({basedir:".",debug:!0,entries:n,cache:{},packageCache:{}}).plugin(tsify,tsConfig).bundle().pipe(source(t)).pipe(buffer()).pipe(sourcemaps.init({loadMaps:!0})).pipe(uglify()).pipe(sourcemaps.write("./")).pipe(gulp.dest(browserifyTargetFolder))}function getBundles(n){return bundleConfig.filter(function(t){return n.test(t.outputFileName)})}function getFileHash(n){return new Promise(function(t,i){var u=crypto.createHash("sha256"),r=fs.createReadStream(n);r.on("error",i);r.on("data",function(n){u.update(n)});r.on("close",function(){t(u.digest("base64"))})})}function writeHashResult(n,t,i){return new Promise(function(r){var u=pathify.parse(t);n.write(u.base+"\t"+i+"\r\n",function(){r()})})}function globMultipleAsync(n){var t;return regeneratorRuntime.async(function(i){for(var r=this;;)switch(i.prev=i.next){case 0:return i.next=2,regeneratorRuntime.awrap(Promise.all(n.map(function(n){return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(globAsync(n));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},null,r)})));case 2:return t=i.sent,i.abrupt("return",t.flat());case 4:case"end":return i.stop()}},null,this)}function globAsync(n){return new Promise(function(t,i){glob(n,function(n,r){n!=null?i():t(r)})})}var gulp=require("gulp"),browserify=require("browserify"),source=require("vinyl-source-stream"),tsify=require("tsify"),uglify=require("gulp-terser"),sourcemaps=require("gulp-sourcemaps"),buffer=require("vinyl-buffer"),browserifyTargetFolder="wwwroot/js/bundles",concat=require("gulp-concat"),cssmin=require("gulp-cssmin"),merge=require("merge-stream"),sass=require("gulp-sass")(require("sass")),crypto=require("crypto"),fs=require("fs"),glob=require("glob"),pathify=require("path"),bundleConfig=require("./bundleconfig.json"),tsConfig=require("./tsconfig.json"),fileRegex={css:/\.css$/,html:/\.(html|htm)$/,js:/\.js$/};gulp.task("build",gulp.series(gulp.parallel(gulp.series(function(){var n=getBundles(fileRegex.js).map(function(n){return gulp.src(n.inputFiles,{base:"."}).pipe(concat(n.outputFileName)).pipe(uglify()).pipe(gulp.dest("."))});return merge(n)}),gulp.series(function(){return gulp.src("wwwroot/css/*.scss",{allowEmpty:!0}).pipe(sass().on("error",sass.logError)).pipe(gulp.dest("wwwroot/css",{allowEmpty:!0}))},function(){var n=getBundles(fileRegex.css).map(function(n){return gulp.src(n.inputFiles,{base:"."}).pipe(concat(n.outputFileName)).pipe(cssmin()).pipe(gulp.dest("."))});return merge(n)},function(){return gulp.src(["wwwroot/libs/lightslider/img/*"]).pipe(gulp.dest("wwwroot/css/img"))}),gulp.series(function(){return browserifyModule(["wwwroot/js/app_ts/Main.ts"],"main.bundle.js")},function(){return browserifyModule(["wwwroot/js/app_ts/EditorMain.ts"],"editormain.bundle.js")})),gulp.series(function(n){var i,t;return regeneratorRuntime.async(function(r){for(var u=this;;)switch(r.prev=r.next){case 0:return r.next=2,regeneratorRuntime.awrap(globMultipleAsync(["wwwroot/js/bundles/*.js","wwwroot/css/bundles/*.css","wwwroot/libs/requirejs/*.js"]));case 2:return i=r.sent,t=fs.createWriteStream("Build/hashes.txt"),r.next=6,regeneratorRuntime.awrap(Promise.all(i.map(function(n){var i;return regeneratorRuntime.async(function(r){for(;;)switch(r.prev=r.next){case 0:return console.log("Hashing "+n),r.next=3,regeneratorRuntime.awrap(getFileHash(n));case 3:return i=r.sent,r.next=6,regeneratorRuntime.awrap(writeHashResult(t,n,i));case 6:case"end":return r.stop()}},null,u)})));case 6:t.close();n();case 8:case"end":return r.stop()}},null,this)})));