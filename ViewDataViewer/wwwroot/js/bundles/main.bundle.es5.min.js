"use strict";!function e(n,t,i){function r(u,e){var s,h,o;if(!t[u]){if(!n[u]){if(s="function"==typeof require&&require,!e&&s)return s(u,!0);if(f)return f(u,!0);h=new Error("Cannot find module '"+u+"'");throw h.code="MODULE_NOT_FOUND",h;}o=t[u]={exports:{}};n[u][0].call(o.exports,function(t){return r(n[u][1][t]||t)},o,o.exports,e,n,t,i)}return t[u].exports}for(var f="function"==typeof require&&require,u=0;u<i.length;u++)r(i[u]);return r}({1:[function(n,t,i){Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function n(){this.isAborted=!1;this.onabort=null}return n.prototype.abort=function(){this.isAborted||(this.isAborted=!0,this.onabort&&this.onabort())},Object.defineProperty(n.prototype,"signal",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"aborted",{get:function(){return this.isAborted},enumerable:!0,configurable:!0}),n}();i.AbortController=r},{}],2:[function(n,t,i){var r,u=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},function(n,t){function i(){this.constructor=n}r(n,t);n.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var f=n("./Errors"),e=n("./FetchHttpClient"),o=n("./HttpClient"),s=n("./Utils"),h=n("./XhrHttpClient"),c=function(n){function t(t){var i=n.call(this)||this;if("undefined"!=typeof fetch||s.Platform.isNode)i.httpClient=new e.FetchHttpClient(t);else{if("undefined"==typeof XMLHttpRequest)throw new Error("No usable HttpClient found.");i.httpClient=new h.XhrHttpClient(t)}return i}return u(t,n),t.prototype.send=function(n){return n.abortSignal&&n.abortSignal.aborted?Promise.reject(new f.AbortError):n.method?n.url?this.httpClient.send(n):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))},t.prototype.getCookieString=function(n){return this.httpClient.getCookieString(n)},t}(o.HttpClient);i.DefaultHttpClient=c},{"./Errors":4,"./FetchHttpClient":5,"./HttpClient":7,"./Utils":20,"./XhrHttpClient":22}],3:[function(n,t,i){Object.defineProperty(i,"__esModule",{value:!0});var r=[0,2e3,1e4,3e4,null],u=function(){function n(n){this.retryDelays=void 0!==n?n.concat([null]):r}return n.prototype.nextRetryDelayInMilliseconds=function(n){return this.retryDelays[n.previousRetryCount]},n}();i.DefaultReconnectPolicy=u},{}],4:[function(n,t,i){var u,r=this&&this.__extends||(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},function(n,t){function i(){this.constructor=n}u(n,t);n.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),f,e,o;Object.defineProperty(i,"__esModule",{value:!0});f=function(n){function t(t,i){var r=this,u=this.constructor.prototype;return(r=n.call(this,t)||this).statusCode=i,r.__proto__=u,r}return r(t,n),t}(Error);i.HttpError=f;e=function(n){function t(t){void 0===t&&(t="A timeout occurred.");var i=this,r=this.constructor.prototype;return(i=n.call(this,t)||this).__proto__=r,i}return r(t,n),t}(Error);i.TimeoutError=e;o=function(n){function t(t){void 0===t&&(t="An abort occurred.");var i=this,r=this.constructor.prototype;return(i=n.call(this,t)||this).__proto__=r,i}return r(t,n),t}(Error);i.AbortError=o},{}],5:[function(n,t,i){var u,o=this&&this.__extends||(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},function(n,t){function i(){this.constructor=n}u(n,t);n.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__assign||Object.assign||function(n){for(var r,i,t=1,u=arguments.length;t<u;t++)for(i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i]);return n},h=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(n){f(n)}}function s(n){try{e(r["throw"](n))}catch(n){f(n)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})},c=this&&this.__generator||function(n,t){function o(e){return function(o){return function(e){if(f)throw new TypeError("Generator is already executing.");for(;r;)try{if(f=1,u&&(i=2&e[0]?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;switch(u=0,i&&(e=[2&e[0],i.value]),e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&&i[i.length-1])||6!==e[0]&&2!==e[0])){r=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(6===e[0]&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(n){e=[6,n];u=0}finally{f=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,o])}}var f,u,i,e,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:o(0),"throw":o(1),"return":o(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e};Object.defineProperty(i,"__esModule",{value:!0});var r=n("./Errors"),f=n("./HttpClient"),e=n("./ILogger"),l=n("./Utils"),a=function(t){function i(i){var r=t.call(this)||this,u;return(r.logger=i,"undefined"==typeof fetch)?(u="function"==typeof __webpack_require__?__non_webpack_require__:n,r.jar=new(u("tough-cookie").CookieJar),r.fetchType=u("node-fetch"),r.fetchType=u("fetch-cookie")(r.fetchType,r.jar),r.abortControllerType=u("abort-controller")):(r.fetchType=fetch.bind(self),r.abortControllerType=AbortController),r}return o(i,t),i.prototype.send=function(n){return h(this,void 0,void 0,function(){var i,u,o,l,t,h,a,v=this;return c(this,function(c){switch(c.label){case 0:if(n.abortSignal&&n.abortSignal.aborted)throw new r.AbortError;if(!n.method)throw new Error("No method defined.");if(!n.url)throw new Error("No url defined.");i=new this.abortControllerType;n.abortSignal&&(n.abortSignal.onabort=function(){i.abort();u=new r.AbortError});o=null;n.timeout&&(l=n.timeout,o=setTimeout(function(){i.abort();v.logger.log(e.LogLevel.Warning,"Timeout from HTTP request.");u=new r.TimeoutError},l));c.label=1;case 1:return c.trys.push([1,3,4,5]),[4,this.fetchType(n.url,{body:n.content,cache:"no-cache",credentials:!0===n.withCredentials?"include":"same-origin",headers:s({"Content-Type":"text/plain;charset=UTF-8","X-Requested-With":"XMLHttpRequest"},n.headers),method:n.method,mode:"cors",redirect:"manual",signal:i.signal})];case 2:return t=c.sent(),[3,5];case 3:if(h=c.sent(),u)throw u;throw this.logger.log(e.LogLevel.Warning,"Error from HTTP request. "+h+"."),h;case 4:return o&&clearTimeout(o),n.abortSignal&&(n.abortSignal.onabort=null),[7];case 5:if(!t.ok)throw new r.HttpError(t.statusText,t.status);return[4,function(n,t){var i;switch(t){case"arraybuffer":i=n.arrayBuffer();break;case"text":i=n.text();break;case"blob":case"document":case"json":throw new Error(t+" is not supported.");default:i=n.text()}return i}(t,n.responseType)];case 6:return a=c.sent(),[2,new f.HttpResponse(t.status,t.statusText,a)]}})})},i.prototype.getCookieString=function(n){var t="";return l.Platform.isNode&&this.jar&&this.jar.getCookies(n,function(n,i){return t=i.join("; ")}),t},i}(f.HttpClient);i.FetchHttpClient=a},{"./Errors":4,"./HttpClient":7,"./ILogger":12,"./Utils":20}],6:[function(n,t,i){(function(t){(function(){Object.defineProperty(i,"__esModule",{value:!0});var r=n("./TextMessageFormat"),u=n("./Utils"),f=function(){function n(){}return n.prototype.writeHandshakeRequest=function(n){return r.TextMessageFormat.write(JSON.stringify(n))},n.prototype.parseHandshakeResponse=function(n){var s,h,f,i,o,e,l,c;if(u.isArrayBuffer(n)||void 0!==t&&n instanceof t){if(f=new Uint8Array(n),-1===(o=f.indexOf(r.TextMessageFormat.RecordSeparatorCode)))throw new Error("Message is incomplete.");i=o+1;s=String.fromCharCode.apply(null,f.slice(0,i));h=f.byteLength>i?f.slice(i).buffer:null}else{if(e=n,-1===(o=e.indexOf(r.TextMessageFormat.RecordSeparator)))throw new Error("Message is incomplete.");i=o+1;s=e.substring(0,i);h=e.length>i?e.substring(i):null}if(l=r.TextMessageFormat.parse(s),c=JSON.parse(l[0]),c.type)throw new Error("Expected a handshake response from the server.");return[h,c]},n}();i.HandshakeProtocol=f}).call(this)}).call(this,n("buffer").Buffer)},{"./TextMessageFormat":19,"./Utils":20,buffer:35}],7:[function(n,t,i){var r=this&&this.__assign||Object.assign||function(n){for(var r,i,t=1,u=arguments.length;t<u;t++)for(i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i]);return n},u,f;Object.defineProperty(i,"__esModule",{value:!0});u=function(n,t,i){this.statusCode=n;this.statusText=t;this.content=i};i.HttpResponse=u;f=function(){function n(){}return n.prototype.get=function(n,t){return this.send(r({},t,{method:"GET",url:n}))},n.prototype.post=function(n,t){return this.send(r({},t,{method:"POST",url:n}))},n.prototype["delete"]=function(n,t){return this.send(r({},t,{method:"DELETE",url:n}))},n.prototype.getCookieString=function(){return""},n}();i.HttpClient=f},{}],8:[function(n,t,i){var l=this&&this.__assign||Object.assign||function(n){for(var r,i,t=1,u=arguments.length;t<u;t++)for(i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i]);return n},o=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(n){f(n)}}function s(n){try{e(r["throw"](n))}catch(n){f(n)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})},e=this&&this.__generator||function(n,t){function o(e){return function(o){return function(e){if(f)throw new TypeError("Generator is already executing.");for(;r;)try{if(f=1,u&&(i=2&e[0]?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;switch(u=0,i&&(e=[2&e[0],i.value]),e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&&i[i.length-1])||6!==e[0]&&2!==e[0])){r=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(6===e[0]&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(n){e=[6,n];u=0}finally{f=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,o])}}var f,u,i,e,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:o(0),"throw":o(1),"return":o(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e},h,s;Object.defineProperty(i,"__esModule",{value:!0});var a=n("./DefaultHttpClient"),r=n("./ILogger"),u=n("./ITransport"),c=n("./LongPollingTransport"),v=n("./ServerSentEventsTransport"),f=n("./Utils"),y=n("./WebSocketTransport"),p=function(){function t(t,i){var r,u,e;if(void 0===i&&(i={}),this.features={},this.negotiateVersion=1,f.Arg.isRequired(t,"url"),this.logger=f.createLogger(i.logger),this.baseUrl=this.resolveUrl(t),(i=i||{}).logMessageContent=void 0!==i.logMessageContent&&i.logMessageContent,"boolean"!=typeof i.withCredentials&&void 0!==i.withCredentials)throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");i.withCredentials=void 0===i.withCredentials||i.withCredentials;r=null;u=null;f.Platform.isNode&&void 0!==n&&(e="function"==typeof __webpack_require__?__non_webpack_require__:n,r=e("ws"),u=e("eventsource"));f.Platform.isNode||"undefined"==typeof WebSocket||i.WebSocket?f.Platform.isNode&&!i.WebSocket&&r&&(i.WebSocket=r):i.WebSocket=WebSocket;f.Platform.isNode||"undefined"==typeof EventSource||i.EventSource?f.Platform.isNode&&!i.EventSource&&void 0!==u&&(i.EventSource=u):i.EventSource=EventSource;this.httpClient=i.httpClient||new a.DefaultHttpClient(this.logger);this.connectionState="Disconnected";this.connectionStarted=!1;this.options=i;this.onreceive=null;this.onclose=null}return t.prototype.start=function(n){return o(this,void 0,void 0,function(){var t;return e(this,function(i){switch(i.label){case 0:return n=n||u.TransferFormat.Binary,f.Arg.isIn(n,u.TransferFormat,"transferFormat"),this.logger.log(r.LogLevel.Debug,"Starting connection with transfer format '"+u.TransferFormat[n]+"'."),"Disconnected"!==this.connectionState?[2,Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."))]:(this.connectionState="Connecting",this.startInternalPromise=this.startInternal(n),[4,this.startInternalPromise]);case 1:return i.sent(),"Disconnecting"!==this.connectionState?[3,3]:(t="Failed to start the HttpConnection before stop() was called.",this.logger.log(r.LogLevel.Error,t),[4,this.stopPromise]);case 2:return i.sent(),[2,Promise.reject(new Error(t))];case 3:if("Connected"!==this.connectionState)return t="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!",this.logger.log(r.LogLevel.Error,t),[2,Promise.reject(new Error(t))];i.label=4;case 4:return this.connectionStarted=!0,[2]}})})},t.prototype.send=function(n){return"Connected"!==this.connectionState?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this.sendQueue||(this.sendQueue=new h(this.transport)),this.sendQueue.send(n))},t.prototype.stop=function(n){return o(this,void 0,void 0,function(){var t=this;return e(this,function(i){switch(i.label){case 0:return"Disconnected"===this.connectionState?(this.logger.log(r.LogLevel.Debug,"Call to HttpConnection.stop("+n+") ignored because the connection is already in the disconnected state."),[2,Promise.resolve()]):"Disconnecting"===this.connectionState?(this.logger.log(r.LogLevel.Debug,"Call to HttpConnection.stop("+n+") ignored because the connection is already in the disconnecting state."),[2,this.stopPromise]):(this.connectionState="Disconnecting",this.stopPromise=new Promise(function(n){t.stopPromiseResolver=n}),[4,this.stopInternal(n)]);case 1:return i.sent(),[4,this.stopPromise];case 2:return i.sent(),[2]}})})},t.prototype.stopInternal=function(n){return o(this,void 0,void 0,function(){var t;return e(this,function(i){switch(i.label){case 0:this.stopError=n;i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.startInternalPromise];case 2:return i.sent(),[3,4];case 3:return i.sent(),[3,4];case 4:if(!this.transport)return[3,9];i.label=5;case 5:return i.trys.push([5,7,,8]),[4,this.transport.stop()];case 6:return i.sent(),[3,8];case 7:return t=i.sent(),this.logger.log(r.LogLevel.Error,"HttpConnection.transport.stop() threw error '"+t+"'."),this.stopConnection(),[3,8];case 8:return this.transport=void 0,[3,10];case 9:this.logger.log(r.LogLevel.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.");this.stopConnection();i.label=10;case 10:return[2]}})})},t.prototype.startInternal=function(n){return o(this,void 0,void 0,function(){var i,t,o,h,f,s;return e(this,function(l){switch(l.label){case 0:i=this.baseUrl;this.accessTokenFactory=this.options.accessTokenFactory;l.label=1;case 1:return l.trys.push([1,12,,13]),this.options.skipNegotiation?this.options.transport!==u.HttpTransportType.WebSockets?[3,3]:(this.transport=this.constructTransport(u.HttpTransportType.WebSockets),[4,this.startTransport(i,n)]):[3,5];case 2:return l.sent(),[3,4];case 3:throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");case 4:return[3,11];case 5:t=null;o=0;h=function(){var n;return e(this,function(r){switch(r.label){case 0:return[4,f.getNegotiationResponse(i)];case 1:if(t=r.sent(),"Disconnecting"===f.connectionState||"Disconnected"===f.connectionState)throw new Error("The connection was stopped during negotiation.");if(t.error)throw new Error(t.error);if(t.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");return t.url&&(i=t.url),t.accessToken&&(n=t.accessToken,f.accessTokenFactory=function(){return n}),o++,[2]}})};f=this;l.label=6;case 6:return[5,h()];case 7:l.sent();l.label=8;case 8:if(t.url&&o<100)return[3,6];l.label=9;case 9:if(100===o&&t.url)throw new Error("Negotiate redirection limit exceeded.");return[4,this.createTransport(i,this.options.transport,t,n)];case 10:l.sent();l.label=11;case 11:return this.transport instanceof c.LongPollingTransport&&(this.features.inherentKeepAlive=!0),"Connecting"===this.connectionState&&(this.logger.log(r.LogLevel.Debug,"The HttpConnection connected successfully."),this.connectionState="Connected"),[3,13];case 12:return s=l.sent(),this.logger.log(r.LogLevel.Error,"Failed to start the connection: "+s),this.connectionState="Disconnected",this.transport=void 0,[2,Promise.reject(s)];case 13:return[2]}})})},t.prototype.getNegotiationResponse=function(n){return o(this,void 0,void 0,function(){var i,c,u,a,v,o,s,t,h;return e(this,function(e){switch(e.label){case 0:return i={},this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(c=e.sent())&&(i.Authorization="Bearer "+c);e.label=2;case 2:u=f.getUserAgentHeader();a=u[0];v=u[1];i[a]=v;o=this.resolveNegotiateUrl(n);this.logger.log(r.LogLevel.Debug,"Sending negotiation request: "+o+".");e.label=3;case 3:return e.trys.push([3,5,,6]),[4,this.httpClient.post(o,{content:"",headers:l({},i,this.options.headers),withCredentials:this.options.withCredentials})];case 4:return 200!==(s=e.sent()).statusCode?[2,Promise.reject(new Error("Unexpected status code returned from negotiate '"+s.statusCode+"'"))]:((!(t=JSON.parse(s.content)).negotiateVersion||t.negotiateVersion<1)&&(t.connectionToken=t.connectionId),[2,t]);case 5:return h=e.sent(),this.logger.log(r.LogLevel.Error,"Failed to complete negotiation with the server: "+h),[2,Promise.reject(h)];case 6:return[2]}})})},t.prototype.createConnectUrl=function(n,t){return t?n+(-1===n.indexOf("?")?"?":"&")+"id="+t:n},t.prototype.createTransport=function(n,t,i,u){return o(this,void 0,void 0,function(){var h,o,p,f,c,a,s,l,w,v,y;return e(this,function(e){switch(e.label){case 0:return h=this.createConnectUrl(n,i.connectionToken),this.isITransport(t)?(this.logger.log(r.LogLevel.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=t,[4,this.startTransport(h,u)]):[3,2];case 1:return e.sent(),this.connectionId=i.connectionId,[2];case 2:o=[];p=i.availableTransports||[];f=i;c=0;a=p;e.label=3;case 3:return c<a.length?(s=a[c],(l=this.resolveTransportOrError(s,t,u))instanceof Error?(o.push(s.transport+" failed: "+l),[3,12]):[3,4]):[3,13];case 4:if(!this.isITransport(l))return[3,12];if(this.transport=l,f)return[3,9];e.label=5;case 5:return e.trys.push([5,7,,8]),[4,this.getNegotiationResponse(n)];case 6:return f=e.sent(),[3,8];case 7:return w=e.sent(),[2,Promise.reject(w)];case 8:h=this.createConnectUrl(n,f.connectionToken);e.label=9;case 9:return e.trys.push([9,11,,12]),[4,this.startTransport(h,u)];case 10:return e.sent(),this.connectionId=f.connectionId,[2];case 11:return v=e.sent(),this.logger.log(r.LogLevel.Error,"Failed to start the transport '"+s.transport+"': "+v),f=void 0,o.push(s.transport+" failed: "+v),"Connecting"!==this.connectionState?(y="Failed to select transport before stop() was called.",this.logger.log(r.LogLevel.Debug,y),[2,Promise.reject(new Error(y))]):[3,12];case 12:return c++,[3,3];case 13:return o.length>0?[2,Promise.reject(new Error("Unable to connect to the server with any of the available transports. "+o.join(" ")))]:[2,Promise.reject(new Error("None of the transports supported by the client are supported by the server."))]}})})},t.prototype.constructTransport=function(n){switch(n){case u.HttpTransportType.WebSockets:if(!this.options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new y.WebSocketTransport(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.WebSocket,this.options.headers||{});case u.HttpTransportType.ServerSentEvents:if(!this.options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new v.ServerSentEventsTransport(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.EventSource,this.options.withCredentials,this.options.headers||{});case u.HttpTransportType.LongPolling:return new c.LongPollingTransport(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.withCredentials,this.options.headers||{});default:throw new Error("Unknown transport: "+n+".");}},t.prototype.startTransport=function(n,t){var i=this;return this.transport.onreceive=this.onreceive,this.transport.onclose=function(n){return i.stopConnection(n)},this.transport.connect(n,t)},t.prototype.resolveTransportOrError=function(n,t,i){var f=u.HttpTransportType[n.transport];if(null==f)return this.logger.log(r.LogLevel.Debug,"Skipping transport '"+n.transport+"' because it is not supported by this client."),new Error("Skipping transport '"+n.transport+"' because it is not supported by this client.");if(!function(n,t){return!n||0!=(t&n)}(t,f))return this.logger.log(r.LogLevel.Debug,"Skipping transport '"+u.HttpTransportType[f]+"' because it was disabled by the client."),new Error("'"+u.HttpTransportType[f]+"' is disabled by the client.");if(!(n.transferFormats.map(function(n){return u.TransferFormat[n]}).indexOf(i)>=0))return this.logger.log(r.LogLevel.Debug,"Skipping transport '"+u.HttpTransportType[f]+"' because it does not support the requested transfer format '"+u.TransferFormat[i]+"'."),new Error("'"+u.HttpTransportType[f]+"' does not support "+u.TransferFormat[i]+".");if(f===u.HttpTransportType.WebSockets&&!this.options.WebSocket||f===u.HttpTransportType.ServerSentEvents&&!this.options.EventSource)return this.logger.log(r.LogLevel.Debug,"Skipping transport '"+u.HttpTransportType[f]+"' because it is not supported in your environment.'"),new Error("'"+u.HttpTransportType[f]+"' is not supported in your environment.");this.logger.log(r.LogLevel.Debug,"Selecting transport '"+u.HttpTransportType[f]+"'.");try{return this.constructTransport(f)}catch(n){return n}},t.prototype.isITransport=function(n){return n&&"object"==typeof n&&"connect"in n},t.prototype.stopConnection=function(n){var t=this;if(this.logger.log(r.LogLevel.Debug,"HttpConnection.stopConnection("+n+") called while in state "+this.connectionState+"."),this.transport=void 0,n=this.stopError||n,this.stopError=void 0,"Disconnected"!==this.connectionState){if("Connecting"===this.connectionState)throw this.logger.log(r.LogLevel.Warning,"Call to HttpConnection.stopConnection("+n+") was ignored because the connection is still in the connecting state."),new Error("HttpConnection.stopConnection("+n+") was called while the connection is still in the connecting state.");if("Disconnecting"===this.connectionState&&this.stopPromiseResolver(),n?this.logger.log(r.LogLevel.Error,"Connection disconnected with error '"+n+"'."):this.logger.log(r.LogLevel.Information,"Connection disconnected."),this.sendQueue&&(this.sendQueue.stop()["catch"](function(n){t.logger.log(r.LogLevel.Error,"TransportSendQueue.stop() threw error '"+n+"'.")}),this.sendQueue=void 0),this.connectionId=void 0,this.connectionState="Disconnected",this.connectionStarted){this.connectionStarted=!1;try{this.onclose&&this.onclose(n)}catch(t){this.logger.log(r.LogLevel.Error,"HttpConnection.onclose("+n+") threw error '"+t+"'.")}}}else this.logger.log(r.LogLevel.Debug,"Call to HttpConnection.stopConnection("+n+") was ignored because the connection is already in the disconnected state.")},t.prototype.resolveUrl=function(n){if(0===n.lastIndexOf("https://",0)||0===n.lastIndexOf("http://",0))return n;if(!f.Platform.isBrowser||!window.document)throw new Error("Cannot resolve '"+n+"'.");var t=window.document.createElement("a");return t.href=n,this.logger.log(r.LogLevel.Information,"Normalizing '"+n+"' to '"+t.href+"'."),t.href},t.prototype.resolveNegotiateUrl=function(n){var i=n.indexOf("?"),t=n.substring(0,-1===i?n.length:i);return"/"!==t[t.length-1]&&(t+="/"),t+="negotiate",-1===(t+=-1===i?"":n.substring(i)).indexOf("negotiateVersion")&&(t+=-1===i?"?":"&",t+="negotiateVersion="+this.negotiateVersion),t},t}();i.HttpConnection=p;h=function(){function n(n){this.transport=n;this.buffer=[];this.executing=!0;this.sendBufferedData=new s;this.transportResult=new s;this.sendLoopPromise=this.sendLoop()}return n.prototype.send=function(n){return this.bufferData(n),this.transportResult||(this.transportResult=new s),this.transportResult.promise},n.prototype.stop=function(){return this.executing=!1,this.sendBufferedData.resolve(),this.sendLoopPromise},n.prototype.bufferData=function(n){if(this.buffer.length&&typeof this.buffer[0]!=typeof n)throw new Error("Expected data to be of type "+typeof this.buffer+" but was of type "+typeof n);this.buffer.push(n);this.sendBufferedData.resolve()},n.prototype.sendLoop=function(){return o(this,void 0,void 0,function(){var t,i,r;return e(this,function(u){switch(u.label){case 0:return[4,this.sendBufferedData.promise];case 1:if(u.sent(),!this.executing)return this.transportResult&&this.transportResult.reject("Connection stopped."),[3,6];this.sendBufferedData=new s;t=this.transportResult;this.transportResult=void 0;i="string"==typeof this.buffer[0]?this.buffer.join(""):n.concatBuffers(this.buffer);this.buffer.length=0;u.label=2;case 2:return u.trys.push([2,4,,5]),[4,this.transport.send(i)];case 3:return u.sent(),t.resolve(),[3,5];case 4:return r=u.sent(),t.reject(r),[3,5];case 5:return[3,0];case 6:return[2]}})})},n.concatBuffers=function(n){for(var i,e=n.map(function(n){return n.byteLength}).reduce(function(n,t){return n+t}),r=new Uint8Array(e),u=0,t=0,f=n;t<f.length;t++)i=f[t],r.set(new Uint8Array(i),u),u+=i.byteLength;return r.buffer},n}();i.TransportSendQueue=h;s=function(){function n(){var n=this;this.promise=new Promise(function(t,i){var r;return r=[t,i],n.resolver=r[0],n.rejecter=r[1],r})}return n.prototype.resolve=function(){this.resolver()},n.prototype.reject=function(n){this.rejecter(n)},n}()},{"./DefaultHttpClient":2,"./ILogger":12,"./ITransport":13,"./LongPollingTransport":16,"./ServerSentEventsTransport":17,"./Utils":20,"./WebSocketTransport":21}],9:[function(n,t,i){var e=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(n){f(n)}}function s(n){try{e(r["throw"](n))}catch(n){f(n)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})},o=this&&this.__generator||function(n,t){function o(e){return function(o){return function(e){if(f)throw new TypeError("Generator is already executing.");for(;r;)try{if(f=1,u&&(i=2&e[0]?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;switch(u=0,i&&(e=[2&e[0],i.value]),e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&&i[i.length-1])||6!==e[0]&&2!==e[0])){r=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(6===e[0]&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(n){e=[6,n];u=0}finally{f=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,o])}}var f,u,i,e,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:o(0),"throw":o(1),"return":o(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e},h;Object.defineProperty(i,"__esModule",{value:!0});var u,c=n("./HandshakeProtocol"),f=n("./IHubProtocol"),r=n("./ILogger"),l=n("./Subject"),s=n("./Utils");!function(n){n.Disconnected="Disconnected";n.Connecting="Connecting";n.Connected="Connected";n.Disconnecting="Disconnecting";n.Reconnecting="Reconnecting"}(u=i.HubConnectionState||(i.HubConnectionState={}));h=function(){function n(n,t,i,r){var e=this;s.Arg.isRequired(n,"connection");s.Arg.isRequired(t,"logger");s.Arg.isRequired(i,"protocol");this.serverTimeoutInMilliseconds=3e4;this.keepAliveIntervalInMilliseconds=15e3;this.logger=t;this.protocol=i;this.connection=n;this.reconnectPolicy=r;this.handshakeProtocol=new c.HandshakeProtocol;this.connection.onreceive=function(n){return e.processIncomingData(n)};this.connection.onclose=function(n){return e.connectionClosed(n)};this.callbacks={};this.methods={};this.closedCallbacks=[];this.reconnectingCallbacks=[];this.reconnectedCallbacks=[];this.invocationId=0;this.receivedHandshakeResponse=!1;this.connectionState=u.Disconnected;this.connectionStarted=!1;this.cachedPingMessage=this.protocol.writeMessage({type:f.MessageType.Ping})}return n.create=function(t,i,r,u){return new n(t,i,r,u)},Object.defineProperty(n.prototype,"state",{get:function(){return this.connectionState},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"connectionId",{get:function(){return this.connection&&this.connection.connectionId||null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"baseUrl",{get:function(){return this.connection.baseUrl||""},set:function(n){if(this.connectionState!==u.Disconnected&&this.connectionState!==u.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!n)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=n},enumerable:!0,configurable:!0}),n.prototype.start=function(){return this.startPromise=this.startWithStateTransitions(),this.startPromise},n.prototype.startWithStateTransitions=function(){return e(this,void 0,void 0,function(){var n;return o(this,function(t){switch(t.label){case 0:if(this.connectionState!==u.Disconnected)return[2,Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."))];this.connectionState=u.Connecting;this.logger.log(r.LogLevel.Debug,"Starting HubConnection.");t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.startInternal()];case 2:return t.sent(),this.connectionState=u.Connected,this.connectionStarted=!0,this.logger.log(r.LogLevel.Debug,"HubConnection connected successfully."),[3,4];case 3:return n=t.sent(),this.connectionState=u.Disconnected,this.logger.log(r.LogLevel.Debug,"HubConnection failed to start successfully because of error '"+n+"'."),[2,Promise.reject(n)];case 4:return[2]}})})},n.prototype.startInternal=function(){return e(this,void 0,void 0,function(){var t,i,n,u=this;return o(this,function(f){switch(f.label){case 0:return this.stopDuringStartError=void 0,this.receivedHandshakeResponse=!1,t=new Promise(function(n,t){u.handshakeResolver=n;u.handshakeRejecter=t}),[4,this.connection.start(this.protocol.transferFormat)];case 1:f.sent();f.label=2;case 2:return f.trys.push([2,5,,7]),i={protocol:this.protocol.name,version:this.protocol.version},this.logger.log(r.LogLevel.Debug,"Sending handshake request."),[4,this.sendMessage(this.handshakeProtocol.writeHandshakeRequest(i))];case 3:return f.sent(),this.logger.log(r.LogLevel.Information,"Using HubProtocol '"+this.protocol.name+"'."),this.cleanupTimeout(),this.resetTimeoutPeriod(),this.resetKeepAliveInterval(),[4,t];case 4:if(f.sent(),this.stopDuringStartError)throw this.stopDuringStartError;return[3,7];case 5:return n=f.sent(),this.logger.log(r.LogLevel.Debug,"Hub handshake failed with error '"+n+"' during start(). Stopping HubConnection."),this.cleanupTimeout(),this.cleanupPingTimer(),[4,this.connection.stop(n)];case 6:throw f.sent(),n;case 7:return[2]}})})},n.prototype.stop=function(){return e(this,void 0,void 0,function(){var n;return o(this,function(t){switch(t.label){case 0:return n=this.startPromise,this.stopPromise=this.stopInternal(),[4,this.stopPromise];case 1:t.sent();t.label=2;case 2:return t.trys.push([2,4,,5]),[4,n];case 3:return t.sent(),[3,5];case 4:return t.sent(),[3,5];case 5:return[2]}})})},n.prototype.stopInternal=function(n){return this.connectionState===u.Disconnected?(this.logger.log(r.LogLevel.Debug,"Call to HubConnection.stop("+n+") ignored because it is already in the disconnected state."),Promise.resolve()):this.connectionState===u.Disconnecting?(this.logger.log(r.LogLevel.Debug,"Call to HttpConnection.stop("+n+") ignored because the connection is already in the disconnecting state."),this.stopPromise):(this.connectionState=u.Disconnecting,this.logger.log(r.LogLevel.Debug,"Stopping HubConnection."),this.reconnectDelayHandle?(this.logger.log(r.LogLevel.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this.reconnectDelayHandle),this.reconnectDelayHandle=void 0,this.completeClose(),Promise.resolve()):(this.cleanupTimeout(),this.cleanupPingTimer(),this.stopDuringStartError=n||new Error("The connection was stopped before the hub handshake could complete."),this.connection.stop(n)))},n.prototype.stream=function(n){for(var r=this,e=[],u=1;u<arguments.length;u++)e[u-1]=arguments[u];var o,s=this.replaceStreamingParams(e),h=s[0],c=s[1],i=this.createStreamInvocation(n,e,c),t=new l.Subject;return t.cancelCallback=function(){var n=r.createCancelInvocation(i.invocationId);return delete r.callbacks[i.invocationId],o.then(function(){return r.sendWithProtocol(n)})},this.callbacks[i.invocationId]=function(n,i){i?t.error(i):n&&(n.type===f.MessageType.Completion?n.error?t.error(new Error(n.error)):t.complete():t.next(n.item))},o=this.sendWithProtocol(i)["catch"](function(n){t.error(n);delete r.callbacks[i.invocationId]}),this.launchStreams(h,o),t},n.prototype.sendMessage=function(n){return this.resetKeepAliveInterval(),this.connection.send(n)},n.prototype.sendWithProtocol=function(n){return this.sendMessage(this.protocol.writeMessage(n))},n.prototype.send=function(n){for(var i=[],t=1;t<arguments.length;t++)i[t-1]=arguments[t];var r=this.replaceStreamingParams(i),f=r[0],e=r[1],u=this.sendWithProtocol(this.createInvocation(n,i,!0,e));return this.launchStreams(f,u),u},n.prototype.invoke=function(n){for(var t=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var e=this.replaceStreamingParams(r),o=e[0],s=e[1],u=this.createInvocation(n,r,!1,s);return new Promise(function(n,i){t.callbacks[u.invocationId]=function(t,r){r?i(r):t&&(t.type===f.MessageType.Completion?t.error?i(new Error(t.error)):n(t.result):i(new Error("Unexpected message type: "+t.type)))};var r=t.sendWithProtocol(u)["catch"](function(n){i(n);delete t.callbacks[u.invocationId]});t.launchStreams(o,r)})},n.prototype.on=function(n,t){n&&t&&(n=n.toLowerCase(),this.methods[n]||(this.methods[n]=[]),-1===this.methods[n].indexOf(t)&&this.methods[n].push(t))},n.prototype.off=function(n,t){var i,r;n&&(n=n.toLowerCase(),i=this.methods[n],i&&(t?(r=i.indexOf(t),-1!==r&&(i.splice(r,1),0===i.length&&delete this.methods[n])):delete this.methods[n]))},n.prototype.onclose=function(n){n&&this.closedCallbacks.push(n)},n.prototype.onreconnecting=function(n){n&&this.reconnectingCallbacks.push(n)},n.prototype.onreconnected=function(n){n&&this.reconnectedCallbacks.push(n)},n.prototype.processIncomingData=function(n){var i,u,t,e,o;if(this.cleanupTimeout(),this.receivedHandshakeResponse||(n=this.processHandshakeResponse(n),this.receivedHandshakeResponse=!0),n)for(i=0,u=this.protocol.parseMessages(n,this.logger);i<u.length;i++){t=u[i];switch(t.type){case f.MessageType.Invocation:this.invokeClientMethod(t);break;case f.MessageType.StreamItem:case f.MessageType.Completion:e=this.callbacks[t.invocationId];e&&(t.type===f.MessageType.Completion&&delete this.callbacks[t.invocationId],e(t));break;case f.MessageType.Ping:break;case f.MessageType.Close:this.logger.log(r.LogLevel.Information,"Close message received from server.");o=t.error?new Error("Server returned an error on close: "+t.error):void 0;!0===t.allowReconnect?this.connection.stop(o):this.stopPromise=this.stopInternal(o);break;default:this.logger.log(r.LogLevel.Warning,"Invalid message type: "+t.type+".")}}this.resetTimeoutPeriod()},n.prototype.processHandshakeResponse=function(n){var f,u,e,t,i;try{e=(f=this.handshakeProtocol.parseHandshakeResponse(n))[0];u=f[1]}catch(n){t="Error parsing handshake response: "+n;this.logger.log(r.LogLevel.Error,t);i=new Error(t);throw this.handshakeRejecter(i),i;}if(u.error){t="Server returned handshake error: "+u.error;this.logger.log(r.LogLevel.Error,t);i=new Error(t);throw this.handshakeRejecter(i),i;}return this.logger.log(r.LogLevel.Debug,"Server handshake complete."),this.handshakeResolver(),e},n.prototype.resetKeepAliveInterval=function(){var n=this;this.connection.features.inherentKeepAlive||(this.cleanupPingTimer(),this.pingServerHandle=setTimeout(function(){return e(n,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:if(this.connectionState!==u.Connected)return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.sendMessage(this.cachedPingMessage)];case 2:return n.sent(),[3,4];case 3:return n.sent(),this.cleanupPingTimer(),[3,4];case 4:return[2]}})})},this.keepAliveIntervalInMilliseconds))},n.prototype.resetTimeoutPeriod=function(){var n=this;this.connection.features&&this.connection.features.inherentKeepAlive||(this.timeoutHandle=setTimeout(function(){return n.serverTimeout()},this.serverTimeoutInMilliseconds))},n.prototype.serverTimeout=function(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))},n.prototype.invokeClientMethod=function(n){var i=this,u=this.methods[n.target.toLowerCase()],t;if(u){try{u.forEach(function(t){return t.apply(i,n.arguments)})}catch(i){this.logger.log(r.LogLevel.Error,"A callback for the method "+n.target.toLowerCase()+" threw error '"+i+"'.")}n.invocationId&&(t="Server requested a response, which is not supported in this version of the client.",this.logger.log(r.LogLevel.Error,t),this.stopPromise=this.stopInternal(new Error(t)))}else this.logger.log(r.LogLevel.Warning,"No client method with the name '"+n.target+"' found.")},n.prototype.connectionClosed=function(n){this.logger.log(r.LogLevel.Debug,"HubConnection.connectionClosed("+n+") called while in state "+this.connectionState+".");this.stopDuringStartError=this.stopDuringStartError||n||new Error("The underlying connection was closed before the hub handshake could complete.");this.handshakeResolver&&this.handshakeResolver();this.cancelCallbacksWithError(n||new Error("Invocation canceled due to the underlying connection being closed."));this.cleanupTimeout();this.cleanupPingTimer();this.connectionState===u.Disconnecting?this.completeClose(n):this.connectionState===u.Connected&&this.reconnectPolicy?this.reconnect(n):this.connectionState===u.Connected&&this.completeClose(n)},n.prototype.completeClose=function(n){var t=this;if(this.connectionStarted){this.connectionState=u.Disconnected;this.connectionStarted=!1;try{this.closedCallbacks.forEach(function(i){return i.apply(t,[n])})}catch(t){this.logger.log(r.LogLevel.Error,"An onclose callback called with error '"+n+"' threw error '"+t+"'.")}}},n.prototype.reconnect=function(n){return e(this,void 0,void 0,function(){var e,t,s,i,f,h=this;return o(this,function(o){switch(o.label){case 0:if(e=Date.now(),t=0,s=void 0!==n?n:new Error("Attempting to reconnect due to a unknown error."),null===(i=this.getNextRetryDelay(t++,0,s)))return this.logger.log(r.LogLevel.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this.completeClose(n),[2];if(this.connectionState=u.Reconnecting,n?this.logger.log(r.LogLevel.Information,"Connection reconnecting because of error '"+n+"'."):this.logger.log(r.LogLevel.Information,"Connection reconnecting."),this.onreconnecting){try{this.reconnectingCallbacks.forEach(function(t){return t.apply(h,[n])})}catch(e){this.logger.log(r.LogLevel.Error,"An onreconnecting callback called with error '"+n+"' threw error '"+e+"'.")}if(this.connectionState!==u.Reconnecting)return this.logger.log(r.LogLevel.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting."),[2]}o.label=1;case 1:return null===i?[3,7]:(this.logger.log(r.LogLevel.Information,"Reconnect attempt number "+t+" will start in "+i+" ms."),[4,new Promise(function(n){h.reconnectDelayHandle=setTimeout(n,i)})]);case 2:if(o.sent(),this.reconnectDelayHandle=void 0,this.connectionState!==u.Reconnecting)return this.logger.log(r.LogLevel.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting."),[2];o.label=3;case 3:return o.trys.push([3,5,,6]),[4,this.startInternal()];case 4:if(o.sent(),this.connectionState=u.Connected,this.logger.log(r.LogLevel.Information,"HubConnection reconnected successfully."),this.onreconnected)try{this.reconnectedCallbacks.forEach(function(n){return n.apply(h,[h.connection.connectionId])})}catch(n){this.logger.log(r.LogLevel.Error,"An onreconnected callback called with connectionId '"+this.connection.connectionId+"; threw error '"+n+"'.")}return[2];case 5:return f=o.sent(),this.logger.log(r.LogLevel.Information,"Reconnect attempt failed because of error '"+f+"'."),this.connectionState!==u.Reconnecting?(this.logger.log(r.LogLevel.Debug,"Connection left the reconnecting state during reconnect attempt. Done reconnecting."),[2]):(s=f instanceof Error?f:new Error(f.toString()),i=this.getNextRetryDelay(t++,Date.now()-e,s),[3,6]);case 6:return[3,1];case 7:return this.logger.log(r.LogLevel.Information,"Reconnect retries have been exhausted after "+(Date.now()-e)+" ms and "+t+" failed attempts. Connection disconnecting."),this.completeClose(),[2]}})})},n.prototype.getNextRetryDelay=function(n,t,i){try{return this.reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:t,previousRetryCount:n,retryReason:i})}catch(i){return this.logger.log(r.LogLevel.Error,"IRetryPolicy.nextRetryDelayInMilliseconds("+n+", "+t+") threw error '"+i+"'."),null}},n.prototype.cancelCallbacksWithError=function(n){var t=this.callbacks;this.callbacks={};Object.keys(t).forEach(function(i){t[i](null,n)})},n.prototype.cleanupPingTimer=function(){this.pingServerHandle&&clearTimeout(this.pingServerHandle)},n.prototype.cleanupTimeout=function(){this.timeoutHandle&&clearTimeout(this.timeoutHandle)},n.prototype.createInvocation=function(n,t,i,r){if(i)return 0!==r.length?{arguments:t,streamIds:r,target:n,type:f.MessageType.Invocation}:{arguments:t,target:n,type:f.MessageType.Invocation};var u=this.invocationId;return this.invocationId++,0!==r.length?{arguments:t,invocationId:u.toString(),streamIds:r,target:n,type:f.MessageType.Invocation}:{arguments:t,invocationId:u.toString(),target:n,type:f.MessageType.Invocation}},n.prototype.launchStreams=function(n,t){var i=this,r,u;if(0!==n.length){t||(t=Promise.resolve());r=function(r){n[r].subscribe({complete:function(){t=t.then(function(){return i.sendWithProtocol(i.createCompletionMessage(r))})},error:function(n){var u;u=n instanceof Error?n.message:n&&n.toString?n.toString():"Unknown error";t=t.then(function(){return i.sendWithProtocol(i.createCompletionMessage(r,u))})},next:function(n){t=t.then(function(){return i.sendWithProtocol(i.createStreamItemMessage(r,n))})}})};for(u in n)r(u)}},n.prototype.replaceStreamingParams=function(n){for(var i,r,u=[],f=[],t=0;t<n.length;t++)i=n[t],this.isObservable(i)&&(r=this.invocationId,this.invocationId++,u[r]=i,f.push(r.toString()),n.splice(t,1));return[u,f]},n.prototype.isObservable=function(n){return n&&n.subscribe&&"function"==typeof n.subscribe},n.prototype.createStreamInvocation=function(n,t,i){var r=this.invocationId;return this.invocationId++,0!==i.length?{arguments:t,invocationId:r.toString(),streamIds:i,target:n,type:f.MessageType.StreamInvocation}:{arguments:t,invocationId:r.toString(),target:n,type:f.MessageType.StreamInvocation}},n.prototype.createCancelInvocation=function(n){return{invocationId:n,type:f.MessageType.CancelInvocation}},n.prototype.createStreamItemMessage=function(n,t){return{invocationId:n,item:t,type:f.MessageType.StreamItem}},n.prototype.createCompletionMessage=function(n,t,i){return t?{error:t,invocationId:n,type:f.MessageType.Completion}:{invocationId:n,result:i,type:f.MessageType.Completion}},n}();i.HubConnection=h},{"./HandshakeProtocol":6,"./IHubProtocol":11,"./ILogger":12,"./Subject":18,"./Utils":20}],10:[function(n,t,i){var e=this&&this.__assign||Object.assign||function(n){for(var r,i,t=1,u=arguments.length;t<u;t++)for(i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i]);return n};Object.defineProperty(i,"__esModule",{value:!0});var f=n("./DefaultReconnectPolicy"),o=n("./HttpConnection"),s=n("./HubConnection"),r=n("./ILogger"),h=n("./JsonHubProtocol"),c=n("./Loggers"),u=n("./Utils"),l={trace:r.LogLevel.Trace,debug:r.LogLevel.Debug,info:r.LogLevel.Information,information:r.LogLevel.Information,warn:r.LogLevel.Warning,warning:r.LogLevel.Warning,error:r.LogLevel.Error,critical:r.LogLevel.Critical,none:r.LogLevel.None},a=function(){function n(){}return n.prototype.configureLogging=function(n){if(u.Arg.isRequired(n,"logging"),void 0!==n.log)this.logger=n;else if("string"==typeof n){var t=function(n){var t=l[n.toLowerCase()];if(void 0!==t)return t;throw new Error("Unknown log level: "+n);}(n);this.logger=new u.ConsoleLogger(t)}else this.logger=new u.ConsoleLogger(n);return this},n.prototype.withUrl=function(n,t){return u.Arg.isRequired(n,"url"),u.Arg.isNotEmpty(n,"url"),this.url=n,this.httpConnectionOptions=e({},this.httpConnectionOptions,"object"==typeof t?t:{transport:t}),this},n.prototype.withHubProtocol=function(n){return u.Arg.isRequired(n,"protocol"),this.protocol=n,this},n.prototype.withAutomaticReconnect=function(n){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return this.reconnectPolicy=n?Array.isArray(n)?new f.DefaultReconnectPolicy(n):n:new f.DefaultReconnectPolicy,this},n.prototype.build=function(){var n=this.httpConnectionOptions||{},t;if(void 0===n.logger&&(n.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");return t=new o.HttpConnection(this.url,n),s.HubConnection.create(t,this.logger||c.NullLogger.instance,this.protocol||new h.JsonHubProtocol,this.reconnectPolicy)},n}();i.HubConnectionBuilder=a},{"./DefaultReconnectPolicy":3,"./HttpConnection":8,"./HubConnection":9,"./ILogger":12,"./JsonHubProtocol":14,"./Loggers":15,"./Utils":20}],11:[function(n,t,i){Object.defineProperty(i,"__esModule",{value:!0}),function(n){n[n.Invocation=1]="Invocation";n[n.StreamItem=2]="StreamItem";n[n.Completion=3]="Completion";n[n.StreamInvocation=4]="StreamInvocation";n[n.CancelInvocation=5]="CancelInvocation";n[n.Ping=6]="Ping";n[n.Close=7]="Close"}(i.MessageType||(i.MessageType={}))},{}],12:[function(n,t,i){Object.defineProperty(i,"__esModule",{value:!0}),function(n){n[n.Trace=0]="Trace";n[n.Debug=1]="Debug";n[n.Information=2]="Information";n[n.Warning=3]="Warning";n[n.Error=4]="Error";n[n.Critical=5]="Critical";n[n.None=6]="None"}(i.LogLevel||(i.LogLevel={}))},{}],13:[function(n,t,i){Object.defineProperty(i,"__esModule",{value:!0}),function(n){n[n.None=0]="None";n[n.WebSockets=1]="WebSockets";n[n.ServerSentEvents=2]="ServerSentEvents";n[n.LongPolling=4]="LongPolling"}(i.HttpTransportType||(i.HttpTransportType={})),function(n){n[n.Text=1]="Text";n[n.Binary=2]="Binary"}(i.TransferFormat||(i.TransferFormat={}))},{}],14:[function(n,t,i){Object.defineProperty(i,"__esModule",{value:!0});var r=n("./IHubProtocol"),f=n("./ILogger"),e=n("./ITransport"),o=n("./Loggers"),u=n("./TextMessageFormat"),s=function(){function n(){this.name="json";this.version=1;this.transferFormat=e.TransferFormat.Text}return n.prototype.parseMessages=function(n,t){var c,i;if("string"!=typeof n)throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!n)return[];null===t&&(t=o.NullLogger.instance);for(var s=[],e=0,h=u.TextMessageFormat.parse(n);e<h.length;e++){if(c=h[e],i=JSON.parse(c),"number"!=typeof i.type)throw new Error("Invalid payload.");switch(i.type){case r.MessageType.Invocation:this.isInvocationMessage(i);break;case r.MessageType.StreamItem:this.isStreamItemMessage(i);break;case r.MessageType.Completion:this.isCompletionMessage(i);break;case r.MessageType.Ping:case r.MessageType.Close:break;default:t.log(f.LogLevel.Information,"Unknown message type '"+i.type+"' ignored.");continue}s.push(i)}return s},n.prototype.writeMessage=function(n){return u.TextMessageFormat.write(JSON.stringify(n))},n.prototype.isInvocationMessage=function(n){this.assertNotEmptyString(n.target,"Invalid payload for Invocation message.");void 0!==n.invocationId&&this.assertNotEmptyString(n.invocationId,"Invalid payload for Invocation message.")},n.prototype.isStreamItemMessage=function(n){if(this.assertNotEmptyString(n.invocationId,"Invalid payload for StreamItem message."),void 0===n.item)throw new Error("Invalid payload for StreamItem message.");},n.prototype.isCompletionMessage=function(n){if(n.result&&n.error)throw new Error("Invalid payload for Completion message.");!n.result&&n.error&&this.assertNotEmptyString(n.error,"Invalid payload for Completion message.");this.assertNotEmptyString(n.invocationId,"Invalid payload for Completion message.")},n.prototype.assertNotEmptyString=function(n,t){if("string"!=typeof n||""===n)throw new Error(t);},n}();i.JsonHubProtocol=s},{"./IHubProtocol":11,"./ILogger":12,"./ITransport":13,"./Loggers":15,"./TextMessageFormat":19}],15:[function(n,t,i){Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function n(){}return n.prototype.log=function(){},n.instance=new n,n}();i.NullLogger=r},{}],16:[function(n,t,i){var h=this&&this.__assign||Object.assign||function(n){for(var r,i,t=1,u=arguments.length;t<u;t++)for(i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i]);return n},f=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(n){f(n)}}function s(n){try{e(r["throw"](n))}catch(n){f(n)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})},e=this&&this.__generator||function(n,t){function o(e){return function(o){return function(e){if(f)throw new TypeError("Generator is already executing.");for(;r;)try{if(f=1,u&&(i=2&e[0]?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;switch(u=0,i&&(e=[2&e[0],i.value]),e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&&i[i.length-1])||6!==e[0]&&2!==e[0])){r=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(6===e[0]&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(n){e=[6,n];u=0}finally{f=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,o])}}var f,u,i,e,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:o(0),"throw":o(1),"return":o(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e};Object.defineProperty(i,"__esModule",{value:!0});var c=n("./AbortController"),o=n("./Errors"),r=n("./ILogger"),s=n("./ITransport"),u=n("./Utils"),l=function(){function n(n,t,i,r,u,f){this.httpClient=n;this.accessTokenFactory=t;this.logger=i;this.pollAbort=new c.AbortController;this.logMessageContent=r;this.withCredentials=u;this.headers=f;this.running=!1;this.onreceive=null;this.onclose=null}return Object.defineProperty(n.prototype,"pollAborted",{get:function(){return this.pollAbort.aborted},enumerable:!0,configurable:!0}),n.prototype.connect=function(n,t){return f(this,void 0,void 0,function(){var a,c,v,y,p,i,w,l,f;return e(this,function(e){switch(e.label){case 0:if(u.Arg.isRequired(n,"url"),u.Arg.isRequired(t,"transferFormat"),u.Arg.isIn(t,s.TransferFormat,"transferFormat"),this.url=n,this.logger.log(r.LogLevel.Trace,"(LongPolling transport) Connecting."),t===s.TransferFormat.Binary&&"undefined"!=typeof XMLHttpRequest&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");return c=u.getUserAgentHeader(),v=c[0],y=c[1],p=h(((a={})[v]=y,a),this.headers),i={abortSignal:this.pollAbort.signal,headers:p,timeout:1e5,withCredentials:this.withCredentials},t===s.TransferFormat.Binary&&(i.responseType="arraybuffer"),[4,this.getAccessToken()];case 1:return w=e.sent(),this.updateHeaderToken(i,w),l=n+"&_="+Date.now(),this.logger.log(r.LogLevel.Trace,"(LongPolling transport) polling: "+l+"."),[4,this.httpClient.get(l,i)];case 2:return 200!==(f=e.sent()).statusCode?(this.logger.log(r.LogLevel.Error,"(LongPolling transport) Unexpected response code: "+f.statusCode+"."),this.closeError=new o.HttpError(f.statusText||"",f.statusCode),this.running=!1):this.running=!0,this.receiving=this.poll(this.url,i),[2]}})})},n.prototype.getAccessToken=function(){return f(this,void 0,void 0,function(){return e(this,function(n){switch(n.label){case 0:return this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:return[2,n.sent()];case 2:return[2,null]}})})},n.prototype.updateHeaderToken=function(n,t){n.headers||(n.headers={});t?n.headers.Authorization="Bearer "+t:n.headers.Authorization&&delete n.headers.Authorization},n.prototype.poll=function(n,t){return f(this,void 0,void 0,function(){var h,s,i,f;return e(this,function(e){switch(e.label){case 0:e.trys.push([0,,8,9]);e.label=1;case 1:return this.running?[4,this.getAccessToken()]:[3,7];case 2:h=e.sent();this.updateHeaderToken(t,h);e.label=3;case 3:return e.trys.push([3,5,,6]),s=n+"&_="+Date.now(),this.logger.log(r.LogLevel.Trace,"(LongPolling transport) polling: "+s+"."),[4,this.httpClient.get(s,t)];case 4:return 204===(i=e.sent()).statusCode?(this.logger.log(r.LogLevel.Information,"(LongPolling transport) Poll terminated by server."),this.running=!1):200!==i.statusCode?(this.logger.log(r.LogLevel.Error,"(LongPolling transport) Unexpected response code: "+i.statusCode+"."),this.closeError=new o.HttpError(i.statusText||"",i.statusCode),this.running=!1):i.content?(this.logger.log(r.LogLevel.Trace,"(LongPolling transport) data received. "+u.getDataDetail(i.content,this.logMessageContent)+"."),this.onreceive&&this.onreceive(i.content)):this.logger.log(r.LogLevel.Trace,"(LongPolling transport) Poll timed out, reissuing."),[3,6];case 5:return f=e.sent(),this.running?f instanceof o.TimeoutError?this.logger.log(r.LogLevel.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this.closeError=f,this.running=!1):this.logger.log(r.LogLevel.Trace,"(LongPolling transport) Poll errored after shutdown: "+f.message),[3,6];case 6:return[3,1];case 7:return[3,9];case 8:return this.logger.log(r.LogLevel.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this.raiseOnClose(),[7];case 9:return[2]}})})},n.prototype.send=function(n){return f(this,void 0,void 0,function(){return e(this,function(){return this.running?[2,u.sendMessage(this.logger,"LongPolling",this.httpClient,this.url,this.accessTokenFactory,n,this.logMessageContent,this.withCredentials,this.headers)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]})})},n.prototype.stop=function(){return f(this,void 0,void 0,function(){var n,t,f,o,i,s;return e(this,function(e){switch(e.label){case 0:this.logger.log(r.LogLevel.Trace,"(LongPolling transport) Stopping polling.");this.running=!1;this.pollAbort.abort();e.label=1;case 1:return e.trys.push([1,,5,6]),[4,this.receiving];case 2:return e.sent(),this.logger.log(r.LogLevel.Trace,"(LongPolling transport) sending DELETE request to "+this.url+"."),n={},t=u.getUserAgentHeader(),f=t[0],o=t[1],n[f]=o,i={headers:h({},n,this.headers),withCredentials:this.withCredentials},[4,this.getAccessToken()];case 3:return s=e.sent(),this.updateHeaderToken(i,s),[4,this.httpClient["delete"](this.url,i)];case 4:return e.sent(),this.logger.log(r.LogLevel.Trace,"(LongPolling transport) DELETE request sent."),[3,6];case 5:return this.logger.log(r.LogLevel.Trace,"(LongPolling transport) Stop finished."),this.raiseOnClose(),[7];case 6:return[2]}})})},n.prototype.raiseOnClose=function(){if(this.onclose){var n="(LongPolling transport) Firing onclose event.";this.closeError&&(n+=" Error: "+this.closeError);this.logger.log(r.LogLevel.Trace,n);this.onclose(this.closeError)}},n}();i.LongPollingTransport=l},{"./AbortController":1,"./Errors":4,"./ILogger":12,"./ITransport":13,"./Utils":20}],17:[function(n,t,i){var s=this&&this.__assign||Object.assign||function(n){for(var r,i,t=1,u=arguments.length;t<u;t++)for(i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i]);return n},f=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(n){f(n)}}function s(n){try{e(r["throw"](n))}catch(n){f(n)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})},e=this&&this.__generator||function(n,t){function o(e){return function(o){return function(e){if(f)throw new TypeError("Generator is already executing.");for(;r;)try{if(f=1,u&&(i=2&e[0]?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;switch(u=0,i&&(e=[2&e[0],i.value]),e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&&i[i.length-1])||6!==e[0]&&2!==e[0])){r=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(6===e[0]&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(n){e=[6,n];u=0}finally{f=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,o])}}var f,u,i,e,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:o(0),"throw":o(1),"return":o(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e};Object.defineProperty(i,"__esModule",{value:!0});var u=n("./ILogger"),o=n("./ITransport"),r=n("./Utils"),h=function(){function n(n,t,i,r,u,f,e){this.httpClient=n;this.accessTokenFactory=t;this.logger=i;this.logMessageContent=r;this.withCredentials=f;this.eventSourceConstructor=u;this.headers=e;this.onreceive=null;this.onclose=null}return n.prototype.connect=function(n,t){return f(this,void 0,void 0,function(){var f,i=this;return e(this,function(e){switch(e.label){case 0:return r.Arg.isRequired(n,"url"),r.Arg.isRequired(t,"transferFormat"),r.Arg.isIn(t,o.TransferFormat,"transferFormat"),this.logger.log(u.LogLevel.Trace,"(SSE transport) Connecting."),this.url=n,this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(f=e.sent())&&(n+=(n.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(f));e.label=2;case 2:return[2,new Promise(function(f,e){var l=!1,h,a,c;if(t===o.TransferFormat.Text){if(r.Platform.isBrowser||r.Platform.isWebWorker)h=new i.eventSourceConstructor(n,{withCredentials:i.withCredentials});else{a=i.httpClient.getCookieString(n);c={};c.Cookie=a;var v=r.getUserAgentHeader(),y=v[0],p=v[1];c[y]=p;h=new i.eventSourceConstructor(n,{withCredentials:i.withCredentials,headers:s({},c,i.headers)})}try{h.onmessage=function(n){if(i.onreceive)try{i.logger.log(u.LogLevel.Trace,"(SSE transport) data received. "+r.getDataDetail(n.data,i.logMessageContent)+".");i.onreceive(n.data)}catch(n){return void i.close(n)}};h.onerror=function(n){var t=new Error(n.data||"Error occurred");l?i.close(t):e(t)};h.onopen=function(){i.logger.log(u.LogLevel.Information,"SSE connected to "+i.url);i.eventSource=h;l=!0;f()}}catch(n){return void e(n)}}else e(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))})]}})})},n.prototype.send=function(n){return f(this,void 0,void 0,function(){return e(this,function(){return this.eventSource?[2,r.sendMessage(this.logger,"SSE",this.httpClient,this.url,this.accessTokenFactory,n,this.logMessageContent,this.withCredentials,this.headers)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]})})},n.prototype.stop=function(){return this.close(),Promise.resolve()},n.prototype.close=function(n){this.eventSource&&(this.eventSource.close(),this.eventSource=void 0,this.onclose&&this.onclose(n))},n}();i.ServerSentEventsTransport=h},{"./ILogger":12,"./ITransport":13,"./Utils":20}],18:[function(n,t,i){Object.defineProperty(i,"__esModule",{value:!0});var r=n("./Utils"),u=function(){function n(){this.observers=[]}return n.prototype.next=function(n){for(var t=0,i=this.observers;t<i.length;t++)i[t].next(n)},n.prototype.error=function(n){for(var r,t=0,i=this.observers;t<i.length;t++)r=i[t],r.error&&r.error(n)},n.prototype.complete=function(){for(var i,n=0,t=this.observers;n<t.length;n++)i=t[n],i.complete&&i.complete()},n.prototype.subscribe=function(n){return this.observers.push(n),new r.SubjectSubscription(this,n)},n}();i.Subject=u},{"./Utils":20}],19:[function(n,t,i){Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function n(){}return n.write=function(t){return""+t+n.RecordSeparator},n.parse=function(t){if(t[t.length-1]!==n.RecordSeparator)throw new Error("Message is incomplete.");var i=t.split(n.RecordSeparator);return i.pop(),i},n.RecordSeparatorCode=30,n.RecordSeparator=String.fromCharCode(n.RecordSeparatorCode),n}();i.TextMessageFormat=r},{}],20:[function(n,t,i){(function(t){(function(){function h(n,t){var i="";return e(n)?(i="Binary data of length "+n.byteLength,t&&(i+=". Content: '"+c(n)+"'")):"string"==typeof n&&(i="String data of length "+n.length,t&&(i+=". Content: '"+n+"'")),i}function c(n){var i=new Uint8Array(n),t="";return i.forEach(function(n){t+="0x"+(n<16?"0":"")+n.toString(16)+" "}),t.substr(0,t.length-1)}function e(n){return n&&"undefined"!=typeof ArrayBuffer&&(n instanceof ArrayBuffer||n.constructor&&"ArrayBuffer"===n.constructor.name)}function a(){var n="X-SignalR-User-Agent";return u.isNode&&(n="User-Agent"),[n,v(i.VERSION,b(),d(),k())]}function v(n,t,i,r){var u="Microsoft SignalR/",f=n.split(".");return u+=f[0]+"."+f[1],u+=" ("+n+"; ",u+=t&&""!==t?t+"; ":"Unknown OS; ",u+=""+i,u+=r?"; "+r:"; Unknown Runtime Version",u+")"}function b(){if(!u.isNode)return"";switch(t.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return t.platform}}function k(){if(u.isNode)return t.versions.node}function d(){return u.isNode?"NodeJS":"Browser"}var y=this&&this.__assign||Object.assign||function(n){for(var r,i,t=1,u=arguments.length;t<u;t++)for(i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i]);return n},p=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(n){f(n)}}function s(n){try{e(r["throw"](n))}catch(n){f(n)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})},w=this&&this.__generator||function(n,t){function o(e){return function(o){return function(e){if(f)throw new TypeError("Generator is already executing.");for(;r;)try{if(f=1,u&&(i=2&e[0]?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;switch(u=0,i&&(e=[2&e[0],i.value]),e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&&i[i.length-1])||6!==e[0]&&2!==e[0])){r=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(6===e[0]&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(n){e=[6,n];u=0}finally{f=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,o])}}var f,u,i,e,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:o(0),"throw":o(1),"return":o(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e},r,o,s,u,l,f;Object.defineProperty(i,"__esModule",{value:!0});r=n("./ILogger");o=n("./Loggers");i.VERSION="5.0.0";s=function(){function n(){}return n.isRequired=function(n,t){if(null==n)throw new Error("The '"+t+"' argument is required.");},n.isNotEmpty=function(n,t){if(!n||n.match(/^\s*$/))throw new Error("The '"+t+"' argument should not be empty.");},n.isIn=function(n,t,i){if(!(n in t))throw new Error("Unknown "+i+" value: "+n+".");},n}();i.Arg=s;u=function(){function n(){}return Object.defineProperty(n,"isBrowser",{get:function(){return"object"==typeof window},enumerable:!0,configurable:!0}),Object.defineProperty(n,"isWebWorker",{get:function(){return"object"==typeof self&&"importScripts"in self},enumerable:!0,configurable:!0}),Object.defineProperty(n,"isNode",{get:function(){return!this.isBrowser&&!this.isWebWorker},enumerable:!0,configurable:!0}),n}();i.Platform=u;i.getDataDetail=h;i.formatArrayBuffer=c;i.isArrayBuffer=e;i.sendMessage=function(n,t,i,u,f,o,s,c,l){return p(this,void 0,void 0,function(){var b,v,k,p,d,g,nt,tt;return w(this,function(w){switch(w.label){case 0:return v={},f?[4,f()]:[3,2];case 1:(k=w.sent())&&((b={}).Authorization="Bearer "+k,v=b);w.label=2;case 2:return p=a(),d=p[0],g=p[1],v[d]=g,n.log(r.LogLevel.Trace,"("+t+" transport) sending data. "+h(o,s)+"."),nt=e(o)?"arraybuffer":"text",[4,i.post(u,{content:o,headers:y({},v,l),responseType:nt,withCredentials:c})];case 3:return tt=w.sent(),n.log(r.LogLevel.Trace,"("+t+" transport) request complete. Response status: "+tt.statusCode+"."),[2]}})})};i.createLogger=function(n){return void 0===n?new f(r.LogLevel.Information):null===n?o.NullLogger.instance:n.log?n:new f(n)};l=function(){function n(n,t){this.subject=n;this.observer=t}return n.prototype.dispose=function(){var n=this.subject.observers.indexOf(this.observer);n>-1&&this.subject.observers.splice(n,1);0===this.subject.observers.length&&this.subject.cancelCallback&&this.subject.cancelCallback()["catch"](function(){})},n}();i.SubjectSubscription=l;f=function(){function n(n){this.minimumLogLevel=n;this.outputConsole=console}return n.prototype.log=function(n,t){if(n>=this.minimumLogLevel)switch(n){case r.LogLevel.Critical:case r.LogLevel.Error:this.outputConsole.error("["+(new Date).toISOString()+"] "+r.LogLevel[n]+": "+t);break;case r.LogLevel.Warning:this.outputConsole.warn("["+(new Date).toISOString()+"] "+r.LogLevel[n]+": "+t);break;case r.LogLevel.Information:this.outputConsole.info("["+(new Date).toISOString()+"] "+r.LogLevel[n]+": "+t);break;default:this.outputConsole.log("["+(new Date).toISOString()+"] "+r.LogLevel[n]+": "+t)}},n}();i.ConsoleLogger=f;i.getUserAgentHeader=a;i.constructUserAgent=v}).call(this)}).call(this,n("_process"))},{"./ILogger":12,"./Loggers":15,_process:37}],21:[function(n,t,i){var e=this&&this.__assign||Object.assign||function(n){for(var r,i,t=1,u=arguments.length;t<u;t++)for(i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i]);return n},o=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(n){f(n)}}function s(n){try{e(r["throw"](n))}catch(n){f(n)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})},s=this&&this.__generator||function(n,t){function o(e){return function(o){return function(e){if(f)throw new TypeError("Generator is already executing.");for(;r;)try{if(f=1,u&&(i=2&e[0]?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;switch(u=0,i&&(e=[2&e[0],i.value]),e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&&i[i.length-1])||6!==e[0]&&2!==e[0])){r=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(6===e[0]&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(n){e=[6,n];u=0}finally{f=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,o])}}var f,u,i,e,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:o(0),"throw":o(1),"return":o(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e};Object.defineProperty(i,"__esModule",{value:!0});var u=n("./ILogger"),f=n("./ITransport"),r=n("./Utils"),h=function(){function n(n,t,i,r,u,f){this.logger=i;this.accessTokenFactory=t;this.logMessageContent=r;this.webSocketConstructor=u;this.httpClient=n;this.onreceive=null;this.onclose=null;this.headers=f}return n.prototype.connect=function(n,t){return o(this,void 0,void 0,function(){var o,i=this;return s(this,function(s){switch(s.label){case 0:return r.Arg.isRequired(n,"url"),r.Arg.isRequired(t,"transferFormat"),r.Arg.isIn(t,f.TransferFormat,"transferFormat"),this.logger.log(u.LogLevel.Trace,"(WebSockets transport) Connecting."),this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(o=s.sent())&&(n+=(n.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(o));s.label=2;case 2:return[2,new Promise(function(o,s){var h,c,l;if(n=n.replace(/^http/,"ws"),c=i.httpClient.getCookieString(n),l=!1,r.Platform.isNode){var a={},v=r.getUserAgentHeader(),y=v[0],p=v[1];a[y]=p;c&&(a.Cookie=""+c);h=new i.webSocketConstructor(n,void 0,{headers:e({},a,i.headers)})}h||(h=new i.webSocketConstructor(n));t===f.TransferFormat.Binary&&(h.binaryType="arraybuffer");h.onopen=function(){i.logger.log(u.LogLevel.Information,"WebSocket connected to "+n+".");i.webSocket=h;l=!0;o()};h.onerror=function(n){var t=null;t="undefined"!=typeof ErrorEvent&&n instanceof ErrorEvent?n.error:new Error("There was an error with the transport.");s(t)};h.onmessage=function(n){if(i.logger.log(u.LogLevel.Trace,"(WebSockets transport) data received. "+r.getDataDetail(n.data,i.logMessageContent)+"."),i.onreceive)try{i.onreceive(n.data)}catch(n){return void i.close(n)}};h.onclose=function(n){if(l)i.close(n);else{var t=null;t="undefined"!=typeof ErrorEvent&&n instanceof ErrorEvent?n.error:new Error("There was an error with the transport.");s(t)}}})]}})})},n.prototype.send=function(n){return this.webSocket&&this.webSocket.readyState===this.webSocketConstructor.OPEN?(this.logger.log(u.LogLevel.Trace,"(WebSockets transport) sending data. "+r.getDataDetail(n,this.logMessageContent)+"."),this.webSocket.send(n),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")},n.prototype.stop=function(){return this.webSocket&&this.close(void 0),Promise.resolve()},n.prototype.close=function(n){this.webSocket&&(this.webSocket.onclose=function(){},this.webSocket.onmessage=function(){},this.webSocket.onerror=function(){},this.webSocket.close(),this.webSocket=void 0);this.logger.log(u.LogLevel.Trace,"(WebSockets transport) socket closed.");this.onclose&&(!this.isCloseEvent(n)||!1!==n.wasClean&&1e3===n.code?n instanceof Error?this.onclose(n):this.onclose():this.onclose(new Error("WebSocket closed with status code: "+n.code+" ("+n.reason+").")))},n.prototype.isCloseEvent=function(n){return n&&"boolean"==typeof n.wasClean&&"number"==typeof n.code},n}();i.WebSocketTransport=h},{"./ILogger":12,"./ITransport":13,"./Utils":20}],22:[function(n,t,i){var u,o=this&&this.__extends||(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},function(n,t){function i(){this.constructor=n}u(n,t);n.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var r=n("./Errors"),f=n("./HttpClient"),e=n("./ILogger"),s=function(n){function t(t){var i=n.call(this)||this;return i.logger=t,i}return o(t,n),t.prototype.send=function(n){var t=this;return n.abortSignal&&n.abortSignal.aborted?Promise.reject(new r.AbortError):n.method?n.url?new Promise(function(i,u){var o=new XMLHttpRequest,s;o.open(n.method,n.url,!0);o.withCredentials=void 0===n.withCredentials||n.withCredentials;o.setRequestHeader("X-Requested-With","XMLHttpRequest");o.setRequestHeader("Content-Type","text/plain;charset=UTF-8");s=n.headers;s&&Object.keys(s).forEach(function(n){o.setRequestHeader(n,s[n])});n.responseType&&(o.responseType=n.responseType);n.abortSignal&&(n.abortSignal.onabort=function(){o.abort();u(new r.AbortError)});n.timeout&&(o.timeout=n.timeout);o.onload=function(){n.abortSignal&&(n.abortSignal.onabort=null);o.status>=200&&o.status<300?i(new f.HttpResponse(o.status,o.statusText,o.response||o.responseText)):u(new r.HttpError(o.statusText,o.status))};o.onerror=function(){t.logger.log(e.LogLevel.Warning,"Error from HTTP request. "+o.status+": "+o.statusText+".");u(new r.HttpError(o.statusText,o.status))};o.ontimeout=function(){t.logger.log(e.LogLevel.Warning,"Timeout from HTTP request.");u(new r.TimeoutError)};o.send(n.content||"")}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))},t}(f.HttpClient);i.XhrHttpClient=s},{"./Errors":4,"./HttpClient":7,"./ILogger":12}],23:[function(n,t,i){var r,u,o,f,s,h,c,e,l,a,v,y;Object.defineProperty(i,"__esModule",{value:!0});r=n("./Errors");i.AbortError=r.AbortError;i.HttpError=r.HttpError;i.TimeoutError=r.TimeoutError;u=n("./HttpClient");i.HttpClient=u.HttpClient;i.HttpResponse=u.HttpResponse;o=n("./DefaultHttpClient");i.DefaultHttpClient=o.DefaultHttpClient;f=n("./HubConnection");i.HubConnection=f.HubConnection;i.HubConnectionState=f.HubConnectionState;s=n("./HubConnectionBuilder");i.HubConnectionBuilder=s.HubConnectionBuilder;h=n("./IHubProtocol");i.MessageType=h.MessageType;c=n("./ILogger");i.LogLevel=c.LogLevel;e=n("./ITransport");i.HttpTransportType=e.HttpTransportType;i.TransferFormat=e.TransferFormat;l=n("./Loggers");i.NullLogger=l.NullLogger;a=n("./JsonHubProtocol");i.JsonHubProtocol=a.JsonHubProtocol;v=n("./Subject");i.Subject=v.Subject;y=n("./Utils");i.VERSION=y.VERSION},{"./DefaultHttpClient":2,"./Errors":4,"./HttpClient":7,"./HubConnection":9,"./HubConnectionBuilder":10,"./IHubProtocol":11,"./ILogger":12,"./ITransport":13,"./JsonHubProtocol":14,"./Loggers":15,"./Subject":18,"./Utils":20}],24:[function(n,t,i){Object.defineProperty(i,"__esModule",{value:!0});i.Hub=void 0;var u=n("./Logger.js"),r=n("@microsoft/signalr"),f=function(){function n(n){var t=this;this.log=new u.Log;this.connection=(new r.HubConnectionBuilder).withUrl("/viewDataHub").configureLogging(r.LogLevel.Error).build();this.connection.on("Received",function(t){n.received(t)});this.connection.on("stats",function(t){n.stats(t)});this.connection.on("exception",function(t){n.exception(t)});this.Server={services:function(){return t.connection.invoke("Services")},isOpen:function(){return t.connection.invoke("IsOpen")},open:function(n){return t.connection.invoke("Open",n)},asyncWrite:function(n){return t.connection.invoke("AsyncWrite",n)},write:function(n){return t.connection.invoke("Write",n)},asyncRead:function(){return t.connection.invoke("AsyncRead")},read:function(){return t.connection.invoke("Read")},close:function(){return t.connection.invoke("Close")}}}return n.prototype.Connect=function(){var n=this;return new Promise(function(t,i){n.connection.state==r.HubConnectionState.Disconnected?n.connection.start().then(function(){n.log.Success("SignalR: started");t()})["catch"](function(t){n.log.Success("SignalR: "+t);i(t)}):t()})},n}();i.Hub=f},{"./Logger.js":25,"@microsoft/signalr":23}],25:[function(n,t,i){Object.defineProperty(i,"__esModule",{value:!0});i.Log=void 0;var r=function(){function n(){}return n.prototype.Success=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.forEach(function(n){return console.log("vd-view: success: "+n)})},n.prototype.Info=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.forEach(function(n){return console.log("vd-view: info:  "+n)})},n.prototype.Error=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.forEach(function(n){return console.log("vd-view: error: "+n)})},n.prototype.Warning=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.forEach(function(n){return console.log("vd-view: warning: "+n)})},n}();i.Log=r},{}],26:[function(n,t,i){Object.defineProperty(i,"__esModule",{value:!0});var r=n("./Views.js");window.vdView={init:function(){var n=new r.Main;ko.applyBindings(n)}}},{"./Views.js":33}],27:[function(n,t,i){function u(n,t,i,r,u){var e=function(){if(n<0||n>15||t<0||t>7)return 32;if(2==t&&i)switch(n){case 3:return 163;default:return 32+n}else{if(2==t&&r)return(u?60928:60960)+n;if(3==t&&i)return 48+n;if(3==t&&r)return(u?60944:60976)+n;if(4==t)return 64+n;if(5==t)switch(n){case 11:return 8592;case 12:return 189;case 13:return 8594;case 14:return 8593;case 15:return 35;default:return 80+n}else if(6==t&&i)switch(n){case 0:return 8211;default:return 96+n}else{if(6==t&&r)return(u?60992:61024)+n;if(7==t&&i)switch(n){case 11:return 188;case 12:return 8214;case 13:return 190;case 14:return 247;case 15:return 9632;default:return 112+n}else if(7==t&&r)return(u?61008:61040)+n}}return 32}();return{code:e,char:String.fromCharCode(e),nativeCode:f(n,t)}}function r(n){var t=(n=n||i.Space).charCodeAt(0),r=0,e=0;switch(t){case 163:e=2;r=3;break;case 8592:e=5;r=11;break;case 189:e=5;r=12;break;case 8594:e=5;r=13;break;case 8593:e=5;r=14;break;case 35:e=5;r=15;break;case 8211:e=6;r=0;break;case 188:e=7;r=11;break;case 8214:e=7;r=12;break;case 190:e=7;r=13;break;case 247:e=7;r=14;break;case 9632:e=7;r=15;break;default:t>=32&&t<48?(e=2,r=t-32):t>=60928&&t<60944?(e=2,r=t-60928):t>=60960&&t<60976?(e=2,r=t-60960):t>=48&&t<64?(e=3,r=t-48):t>=60944&&t<60960?(e=3,r=t-60944):t>=60976&&t<60992?(e=3,r=t-60976):t>=64&&t<80?(e=4,r=t-64):t>=80&&t<96?(e=5,r=t-80):t>=96&&t<112?(e=6,r=t-96):t>=60992&&t<61008?(e=6,r=t-60992):t>=61024&&t<61040?(e=6,r=t-61024):t>=112&&t<128?(e=7,r=t-112):t>=61008&&t<61024?(e=7,r=t-61008):t>=61040&&t<61056?(e=7,r=t-61040):(e=2,r=0)}return{colCode:e,rowCode:r,code:f(r,e),char:u(r,e,!0,!1,!1).char}}function f(n,t){return(t<<4)+n&127}var e=this&&this.__read||function(n,t){var i="function"==typeof Symbol&&n[Symbol.iterator],r,f,u,e;if(!i)return n;u=i.call(n);e=[];try{for(;(void 0===t||t-->0)&&!(r=u.next()).done;)e.push(r.value)}catch(n){f={error:n}}finally{try{r&&!r.done&&(i=u["return"])&&i.call(u)}finally{if(f)throw f.error;}}return e},o=this&&this.__spread||function(){for(var n=[],t=0;t<arguments.length;t++)n=n.concat(e(arguments[t]));return n};Object.defineProperty(i,"__esModule",{value:!0});i.IsMosaic=i.FromKeyboardString=i.FromKeyboard=i.ToDisplay=i.Space=void 0;i.Space=" ";i.ToDisplay=u;i.FromKeyboard=r;i.FromKeyboardString=function(n){return o(String(n||"")).map(function(n){return n.charCodeAt(0)<32?n:String.fromCharCode(r(n).code)}).join("")};i.IsMosaic=function(n){switch(r(n).colCode){case 2:case 3:case 6:case 7:return!0}return!1}},{}],28:[function(n,t,i){var o=this&&this.__read||function(n,t){var i="function"==typeof Symbol&&n[Symbol.iterator],r,f,u,e;if(!i)return n;u=i.call(n);e=[];try{for(;(void 0===t||t-->0)&&!(r=u.next()).done;)e.push(r.value)}catch(n){f={error:n}}finally{try{r&&!r.done&&(i=u["return"])&&i.call(u)}finally{if(f)throw f.error;}}return e},s=this&&this.__spread||function(){for(var n=[],t=0;t<arguments.length;t++)n=n.concat(o(arguments[t]));return n},f,e;Object.defineProperty(i,"__esModule",{value:!0});i.SAA5050=void 0;var r=n("./Terminal.js"),u=n("./Mode7.js"),h=function(){function n(n){var t=this;this.displayBuffer=n;this.flags=new f;this.afterFlags=new e;this.bufferRowIdx=0;this.bufferColIdx=0;this.doubleHeightLowerRowIdx=-1;this.lastCharacter=null;this.frameBufferMax=2e3;this.frameBuffer=new Uint8Array(this.frameBufferMax);this.frameBufferOffset=0;this.headerRow=Array(r.Constants.MaxCols);this.Flags={IsEscaped:ko.computed(function(){return t.flags.IsEscaped()}),IsContiguous:ko.computed(function(){return t.flags.IsContiguous()}),IsCursorOn:ko.computed(function(){return t.flags.IsCursorOn()}),IsDoubleHeight:ko.computed(function(){return t.flags.IsDoubleHeight()}),IsConcealed:ko.computed(function(){return t.flags.IsConcealed()}),IsFlashing:ko.computed(function(){return t.flags.IsFlashing()}),IsAlpha:ko.computed(function(){return t.flags.IsAlpha()}),IsGraphics:ko.computed(function(){return!t.flags.IsAlpha()}),AlphaFgColour:ko.computed(function(){return t.flags.AlphaFgColour()}),MosaicFgColour:ko.computed(function(){return t.flags.MosaicFgColour()}),BgColour:ko.computed(function(){return t.flags.BgColour()}),IsMosaicHeld:ko.computed(function(){return t.flags.IsMosaicHeld()}),HeldMosaic:ko.computed(function(){return t.flags.IsMosaicHeld()?t.flags.HeldMosaic():null})};[].fill(0);this.headerRow.fill(u.Space)}return n.prototype.DecodeBase64=function(n){var t=Uint8Array.from(atob(n),function(n){return n.charCodeAt(0)});return this.DecodeBytes(t)},n.prototype.DecodeBytes=function(n){for(var e,f,i,t,s,o=0;o<n.length&&this.bufferRowIdx<r.Constants.MaxRows;++o){e=n[o];switch(this.frameBufferOffset<this.frameBufferMax&&this.frameBuffer.set([e],this.frameBufferOffset++),e){case 0:continue;case 8:--this.bufferColIdx;this.bufferColIdx<0&&(this.bufferColIdx=r.Constants.MaxCols-1,--this.bufferRowIdx,this.bufferRowIdx<0&&(this.bufferRowIdx=r.Constants.MaxRows-1));continue;case 9:++this.bufferColIdx;this.bufferColIdx>=r.Constants.MaxCols&&(this.bufferColIdx=0,++this.bufferRowIdx,this.bufferRowIdx>=r.Constants.MaxRows&&(this.bufferRowIdx=0));continue;case 10:this.nextRow();continue;case 11:--this.bufferRowIdx;this.bufferRowIdx<0&&(this.bufferRowIdx=r.Constants.MaxRows-1);continue;case 12:this.newFrame();continue;case 13:this.fillEnd();this.bufferColIdx=0;continue;case 17:this.flags.IsCursorOn(!0);continue;case 20:this.flags.IsCursorOn(!1);this.displayBuffer.CursorOff();continue;case 30:this.fillEnd();this.bufferColIdx=0;this.bufferRowIdx=0;continue}if(f=15&e,i=(112&e)>>4,this.flags.IsEscaped()&&(i&=1,this.flags.IsEscaped(!1)),0==i)switch(f){case 0:break;case 8:this.afterFlags.isFlashing=!0;break;case 9:this.flags.IsFlashing(!1);break;case 10:this.afterFlags.isBoxing=!1;break;case 11:this.afterFlags.isBoxing=!0;break;case 12:this.flags.IsDoubleHeight(!1);this.flags.HeldMosaic(u.Space);break;case 13:this.bufferRowIdx<r.Constants.MaxRows-2&&(this.afterFlags.isDoubleHeight=!0);break;case 14:case 15:break;default:this.afterFlags.alphaFgColour=f}else if(1==i)switch(f){case 0:break;case 8:this.flags.IsConcealed(!0);break;case 9:this.flags.IsContiguous(!0);break;case 10:this.flags.IsContiguous(!1);break;case 11:this.flags.IsEscaped(!0);continue;case 12:this.flags.BgColour(0);break;case 13:this.flags.BgColour(this.flags.IsAlpha()?this.flags.AlphaFgColour():this.flags.MosaicFgColour());break;case 14:this.flags.IsMosaicHeld(!0);break;case 15:this.afterFlags.isMosaicHeld=!1;break;default:this.afterFlags.mosaicFgColour=f}this.bufferRowIdx!=this.doubleHeightLowerRowIdx&&(t=this.displayBuffer.Cell(this.bufferRowIdx,this.bufferColIdx),(t.Fg=this.flags.IsAlpha()?this.flags.AlphaFgColour():this.flags.MosaicFgColour(),t.Bg(this.flags.BgColour()),t.IsFlashing(this.flags.IsFlashing()),t.IsConcealed(this.flags.IsConcealed()),t.IsDoubleHeight(this.flags.IsDoubleHeight()),this.flags.IsDoubleHeight())&&(s=this.displayBuffer.Cell(this.doubleHeightLowerRowIdx,this.bufferColIdx),s.Bg(this.flags.BgColour()),s.IsFlashing(this.flags.IsFlashing()),s.IsConcealed(this.flags.IsConcealed())),0==i||1==i?(t.SetCharacter(this.flags.IsMosaicHeld()?this.flags.HeldMosaic():u.Space,this.flags.IsMosaicHeld()&&this.flags.IsHeldMosaicContiguous()),0==this.bufferRowIdx&&(this.headerRow[this.bufferColIdx]=u.Space)):(this.lastCharacter=this.getChar(f,i),t.SetCharacter(this.lastCharacter,!this.flags.IsAlpha()&&this.flags.IsContiguous()),this.flags.IsAlpha()||(this.flags.HeldMosaic(this.lastCharacter),this.flags.IsHeldMosaicContiguous(this.flags.IsContiguous())),0==this.bufferRowIdx&&(this.headerRow[this.bufferColIdx]=this.lastCharacter)));this.flags.SetAfterFlags(this.afterFlags);this.afterFlags.isDoubleHeight&&(this.doubleHeightLowerRowIdx=this.bufferRowIdx+1,this.displayBuffer.Rows[this.doubleHeightLowerRowIdx].SetIsDoubleHeightLowerRow());this.afterFlags.Reset();++this.bufferColIdx;this.bufferColIdx==r.Constants.MaxCols&&this.nextRow()}return this.displayBuffer.CursorOff(),this.flags.IsCursorOn()&&this.displayBuffer.CursorOn(this.bufferRowIdx,this.bufferColIdx),n.length},n.prototype.Reset=function(){this.newFrame();this.flags.IsCursorOn(!1);this.displayBuffer.ResetCursor()},n.prototype.Load=function(n){this.Reset();this.DecodeBase64(n)},n.prototype.GetFrameAsBase64=function(){return btoa(String.fromCharCode.apply(String,s(this.frameBuffer.slice(0,this.frameBufferOffset))))},n.prototype.FrameNumber=function(){var n=this.headerRow.join("").match(/ P?(\d+)|(\d+[a-z]) /);return n&&n.length>1?n[1]:"0"},n.prototype.newFrame=function(){this.bufferRowIdx=this.bufferColIdx=0;this.flags.Reset();this.afterFlags.Reset();this.displayBuffer.Reset();this.frameBufferOffset=0;this.doubleHeightLowerRowIdx=-1;this.headerRow.fill(u.Space)},n.prototype.nextRow=function(){this.bufferRowIdx+1<r.Constants.MaxRows?++this.bufferRowIdx:this.bufferRowIdx=0;this.bufferColIdx=0;this.flags.Reset();this.afterFlags.Reset()},n.prototype.fillEnd=function(){var n,i,t;if(this.bufferColIdx>0)for(n=this.displayBuffer.Cell(this.bufferRowIdx,this.bufferColIdx-1),i=this.bufferColIdx;i<r.Constants.MaxCols;++i)t=this.displayBuffer.Cell(this.bufferRowIdx,i),t.Fg=n.Fg,t.Bg(n.Bg()),t.IsFlashing(n.IsFlashing()),t.IsConcealed(n.IsConcealed()),t.IsDoubleHeight(n.IsDoubleHeight())},n.prototype.getChar=function(n,t){return u.ToDisplay(n,t,this.flags.IsAlpha(),!this.flags.IsAlpha(),this.flags.IsContiguous()).char},n}();i.SAA5050=h;f=function(){function n(){this.BgColour=ko.observable(r.Colours.black);this.AlphaFgColour=ko.observable(r.Colours.white);this.MosaicFgColour=ko.observable(r.Colours.white);this.IsAlpha=ko.observable(!0);this.IsContiguous=ko.observable(!0);this.IsFlashing=ko.observable(!1);this.IsEscaped=ko.observable(!1);this.IsBoxing=ko.observable(!1);this.IsConcealed=ko.observable(!1);this.IsMosaicHeld=ko.observable(!1);this.HeldMosaic=ko.observable(u.Space);this.IsHeldMosaicContiguous=ko.observable(!1);this.IsDoubleHeight=ko.observable(!1);this.IsCursorOn=ko.observable(!1)}return n.prototype.Reset=function(){this.BgColour(r.Colours.black);this.AlphaFgColour(r.Colours.white);this.IsAlpha(!0);this.IsFlashing(!1);this.IsEscaped(!1);this.IsBoxing(!1);this.IsConcealed(!1);this.IsContiguous(!0);this.IsMosaicHeld(!1);this.HeldMosaic(u.Space);this.IsHeldMosaicContiguous(!1);this.IsDoubleHeight(!1)},n.prototype.SetAfterFlags=function(n){var t=this.IsAlpha();null!=n.alphaFgColour?(this.AlphaFgColour(n.alphaFgColour),this.IsAlpha(!0),this.IsConcealed(!1)):null!=n.mosaicFgColour&&(this.MosaicFgColour(n.mosaicFgColour),this.IsAlpha(!1),this.IsConcealed(!1));this.IsAlpha()!=t&&(this.HeldMosaic(u.Space),this.IsHeldMosaicContiguous(!1));!0===n.isFlashing&&this.IsFlashing(!0);null!=n.isBoxing&&this.IsBoxing(!!n.isBoxing);!1===n.isMosaicHeld&&(this.IsMosaicHeld(!1),this.IsHeldMosaicContiguous(!1));!0===n.isDoubleHeight&&this.IsDoubleHeight(!0)},n}();e=function(){function n(){this.alphaFgColour=null;this.mosaicFgColour=null;this.isFlashing=null;this.isBoxing=null;this.isMosaicHeld=null;this.isDoubleHeight=null}return n.prototype.Reset=function(){this.alphaFgColour=null;this.mosaicFgColour=null;this.isFlashing=null;this.isBoxing=null;this.isMosaicHeld=null;this.isDoubleHeight=null},n}()},{"./Mode7.js":27,"./Terminal.js":32}],29:[function(n,t,i){var o=this&&this.__generator||function(n,t){function o(e){return function(o){return function(e){if(f)throw new TypeError("Generator is already executing.");for(;r;)try{if(f=1,u&&(i=2&e[0]?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;switch(u=0,i&&(e=[2&e[0],i.value]),e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&&i[i.length-1])||6!==e[0]&&2!==e[0])){r=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(6===e[0]&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(n){e=[6,n];u=0}finally{f=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,o])}}var f,u,i,e,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:o(0),"throw":o(1),"return":o(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e},s=this&&this.__read||function(n,t){var i="function"==typeof Symbol&&n[Symbol.iterator],r,f,u,e;if(!i)return n;u=i.call(n);e=[];try{for(;(void 0===t||t-->0)&&!(r=u.next()).done;)e.push(r.value)}catch(n){f={error:n}}finally{try{r&&!r.done&&(i=u["return"])&&i.call(u)}finally{if(f)throw f.error;}}return e},f=this&&this.__spread||function(){for(var n=[],t=0;t<arguments.length;t++)n=n.concat(s(arguments[t]));return n},u,e;Object.defineProperty(i,"__esModule",{value:!0});i.Storage=i.Download=i.Frame=void 0;var h=n("./Terminal.js"),c=n("./Views.js"),r=function(n){this.b64=n.b64;this.thumbnail=n.thumbnail;this.uri="data:"+n.thumbnail.mime+";base64,"+n.thumbnail.b64};i.Frame=r;u=function(n){this.filename=n.filename;this.size=n.size;this.b64=n.b64;this.mime=n.mime;this.uri="data:"+n.mime+";base64,"+n.b64};i.Download=u;e=function(){function n(){this.MimeTypes={Binary:"application/octet-stream",ImagePng:"image/png"};this.frameKeyPrefix=/^SF_([0-9]+)$/;this.downloadKeyPrefix=/^DL_(.+)$/;this.storage=window.localStorage;this.frameKeys=f(this.getKeys(this.frameKeyPrefix));this.downloadKeys=f(this.getKeys(this.downloadKeyPrefix));this.frameKeys.sort();this.downloadKeys.sort()}return Object.defineProperty(n.prototype,"EnableFlashing",{get:function(){return"true"==this.storage.getItem("EnableFlashing")},set:function(n){this.storage.setItem("EnableFlashing",String(!0===n))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"MessageSequenceNumber",{get:function(){return Number(this.storage.getItem("MessageSequenceNumber"))||0},set:function(n){this.storage.setItem("MessageSequenceNumber",String(n))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"Version",{get:function(){return Number(this.storage.getItem("Version"))||0},set:function(n){this.storage.setItem("Version",String(n))},enumerable:!1,configurable:!0}),n.prototype.Frames=function(){var n=this;return this.frameKeys.map(function(t){try{return new r(JSON.parse(n.storage.getItem(t)))}catch(i){n.storage.removeItem(t)}return null}).filter(function(n){return null!=n})},n.prototype.GetFrameAt=function(n){return new r(JSON.parse(this.storage.getItem(this.frameKeys[n])))},n.prototype.RemoveFrameAt=function(n){this.storage.removeItem(this.frameKeys[n]);this.frameKeys.splice(n,1)},n.prototype.AddFrame=function(n,t){var i="SF_"+this.getSeqNo(),u={b64:n,thumbnail:t};return this.storage.setItem(i,JSON.stringify(u)),this.frameKeys.push(i),new r(u)},n.prototype.Downloads=function(){var n=this;return this.downloadKeys.map(function(t){try{return new u(JSON.parse(n.storage.getItem(t)))}catch(i){n.storage.removeItem(t)}return null}).filter(function(n){return null!=n})},n.prototype.RemoveDownloadAt=function(n){this.storage.removeItem(this.downloadKeys[n]);this.downloadKeys.splice(n,1)},n.prototype.AddDownload=function(n,t,i,r){void 0===r&&(r=this.MimeTypes.Binary);var f="DL_"+n+"_"+this.getSeqNo(),e={filename:n,size:t,b64:i,mime:r};return this.storage.setItem(f,JSON.stringify(e)),this.downloadKeys.push(f),new u(e)},n.prototype.Migrate=function(){var n=this,i,t;(0==this.Version&&("true"==this.storage.getItem("HelpDismissed")&&(this.MessageSequenceNumber=1),this.storage.removeItem("HelpDismissed"),this.Version=1),1==this.Version&&(this.downloadKeys.forEach(function(t){var i=JSON.parse(n.storage.getItem(t));i.hasOwnProperty("mime")||(i.mime=n.MimeTypes.Binary);n.storage.setItem(t,JSON.stringify(i))}),this.Version=2),2==this.Version)&&(i=document.getElementById("Canvas"),t=new c.ViewDataView,this.frameKeys.forEach(function(r){var u=n.storage.getItem(r),f;t.Decoder.Load(u);f=h.SaveAsImage(t.Buffer,i,160,125);n.storage.setItem(r,JSON.stringify({b64:u,thumbnail:f}))}),this.Version=3);3==this.Version&&(this.storage.removeItem("MessageSequenceNumber"),this.Version=4)},n.prototype.getKeys=function(n){var t,i;return o(this,function(r){switch(r.label){case 0:t=0;r.label=1;case 1:return t<this.storage.length?(i=this.storage.key(t),n.test(i)?[4,i]:[3,3]):[3,4];case 2:r.sent();r.label=3;case 3:return++t,[3,1];case 4:return[2]}})},n.prototype.getSeqNo=function(){return Date.now()+Math.floor(10*Math.random())},n}();i.Storage=e},{"./Terminal.js":32,"./Views.js":33}],30:[function(n,t,i){var s=this&&this.__read||function(n,t){var i="function"==typeof Symbol&&n[Symbol.iterator],r,f,u,e;if(!i)return n;u=i.call(n);e=[];try{for(;(void 0===t||t-->0)&&!(r=u.next()).done;)e.push(r.value)}catch(n){f={error:n}}finally{try{r&&!r.done&&(i=u["return"])&&i.call(u)}finally{if(f)throw f.error;}}return e},h=this&&this.__spread||function(){for(var n=[],t=0;t<arguments.length;t++)n=n.concat(s(arguments[t]));return n},f,e;Object.defineProperty(i,"__esModule",{value:!0});i.SvgBufferCell=i.SvgBufferRow=i.SvgBufferTransform=void 0;var u=n("./Terminal.js"),o=n("./Mode7.js"),r=function(){function n(){}return n.CellHeight=20,n.CellDoubleHeight=40,n.CellWidth=15,n.FontDescender=4,n.DoubleFontDescender=8,n}(),c=function(){function n(n,t){this.buffer=n;this.ShowGrid=t;this.Rows=h(n.Rows,[n.StatusRow]).map(function(n,t,i){return new f(i,t)});this.ViewBox=ko.computed(function(){return"0 0 "+u.Constants.MaxCols*r.CellWidth+" "+(u.Constants.MaxRows+1)*r.CellHeight});this.Grid=this.getGridLines()}return n.prototype.getGridLines=function(){for(var e,i,n,o,s=u.Constants.MaxCols*r.CellWidth,h=u.Constants.MaxRows*r.CellHeight,f=[],t=0;t<=u.Constants.MaxCols;++t)e=t*r.CellWidth,i=t>0&&t<u.Constants.MaxCols&&t%10==0,f.push({X1:e,Y1:0,X2:e,Y2:h-1,Css:"gcol "+(i?"gcol-10":"")});for(n=0;n<=u.Constants.MaxRows;++n)o=n*r.CellHeight,i=n>0&&n<u.Constants.MaxRows&&n%10==0,f.push({X1:0,Y1:o,X2:s-1,Y2:o,Css:"grow "+(i?"grow-10":"")});return f},n}();i.SvgBufferTransform=c;f=function(n,t){var i=this;this.bufferRows=n;this.RowIdx=t;this.myBufferRow=this.bufferRows[this.RowIdx];this.IsHidden=this.myBufferRow.IsHidden;this.Y=ko.computed(function(){return i.RowIdx*r.CellHeight});this.IsAnyDoubleHeight=ko.computed(function(){return i.myBufferRow.Cells.some(function(n){return n.IsDoubleHeight()})});this.RowHeight=ko.computed(function(){return i.IsHidden()?0:i.IsAnyDoubleHeight()?r.CellDoubleHeight:r.CellHeight});this.Cells=this.myBufferRow.Cells.map(function(n,t){return new e(i,n,t)})};i.SvgBufferRow=f;e=function(n,t,i){var f=this;this.row=n;this.bufferCell=t;this.colIdx=i;this.Character=this.bufferCell.Character;this.FontDescender=ko.computed(function(){return f.bufferCell.IsDoubleHeight()?r.DoubleFontDescender:r.FontDescender});this.FontSize=ko.computed(function(){return""+(f.bufferCell.IsDoubleHeight()?r.CellDoubleHeight:r.CellHeight)});this.Width=ko.observable(r.CellWidth);this.CellHeight=ko.computed(function(){return f.row.IsHidden()?0:f.bufferCell.IsDoubleHeight()?r.CellDoubleHeight:r.CellHeight});this.X=ko.observable(this.colIdx*r.CellWidth);this.TextX=ko.computed(function(){return f.X()-1});this.Y=this.row.Y;this.TextY=ko.computed(function(){return f.row.IsHidden()?0:f.Y()+f.CellHeight()-f.FontDescender()});this.CellCss=ko.computed(function(){var n=f.bufferCell.IsContiguousMosaic()&&o.IsMosaic(f.Character());return"svg-viewdata-view-cell "+(f.bufferCell.IsFlashing()?"blink":"")+" "+(f.bufferCell.IsDoubleHeight()?"double-height":"")+" "+(f.bufferCell.IsConcealed()?"concealed":"")+" "+(n?"mosaic":"")});this.BgCss=ko.computed(function(){return"bg-"+(f.bufferCell.IsCursor()?u.Colours[u.Colours.white]:u.Colours[f.bufferCell.Bg()])});this.FgCss=ko.computed(function(){return"fg-"+(f.bufferCell.IsCursor()?u.Colours[u.Colours.black]:u.Colours[f.bufferCell.Fg])});this.Id=ko.computed(function(){return"row-"+f.row.RowIdx+"-col-"+f.colIdx});this.Fixes=ko.computed(function(){var n=[];return f.bufferCell.IsContiguousMosaic()&&o.IsMosaic(f.Character())&&n.push({X:f.TextX(),Y:f.TextY()-2}),n})};i.SvgBufferCell=e},{"./Mode7.js":27,"./Terminal.js":32}],31:[function(n,t,i){Object.defineProperty(i,"__esModule",{value:!0});i.Downloads=void 0;var r=function(){function n(){this.buffer=[]}return n.prototype.Reset=function(){this.buffer.length=0},n.prototype.Write=function(n){this.buffer.push(String.fromCharCode(n))},n.prototype.Length=function(){return this.buffer.length},n.prototype.GetBase64=function(){return btoa(this.buffer.join(""))},n}(),u=function(){function n(n,t,i){this.onError=n;this.onEndOfFrame=t;this.onEndOfFile=i;this.threeQuarters=125;this.space=32;this.bar=124;this.outputBuffer=new r;this.state=0;this.frameNumber=0;this.runningChecksum=0;this.checksum=0;this.frameLetter=null;this.shiftOffset=0;this.controlCode=null;this.ignore=!1;this.inFrame=!1;this.filename=""}return n.prototype.Reset=function(){this.outputBuffer.Reset();this.state=0;this.frameNumber=0;this.runningChecksum=0;this.checksum=0;this.frameLetter=null;this.shiftOffset=0;this.controlCode=null;this.ignore=!1;this.inFrame=!1;this.filename=""},n.prototype.TryDecodeHeaderFrame=function(n){return this.Decode(n,!1),1===this.frameNumber&&!!this.filename},n.prototype.Decode=function(n,t,i){var u,f,r,e;for(void 0===t&&(t=!0),void 0===i&&(i=!1),u=Uint8Array.from(atob(n),function(n){return n.charCodeAt(0)}),f=0;f<u.length;++f)if(r=u[f],i&&this.inFrame&&this.parity(r)!==r>>7&&this.onError("parity error in frame "+this.frameNumber),(r&=127)!=this.bar){if(e=String.fromCharCode(r),this.inFrame&&0===this.state)this.runningChecksum^=r,this.ignore||(1===this.frameNumber?"I"===this.controlCode&&(this.filename+=e):r==this.threeQuarters?this.outputBuffer.Write(this.space+this.shiftOffset):this.outputBuffer.Write(r+this.shiftOffset));else if(this.state>=1)switch(1===this.state&&(this.controlCode=e,"A"!==this.controlCode&&"Z"!==this.controlCode&&(this.runningChecksum^=124,this.runningChecksum^=r)),this.controlCode){case"0":this.shiftOffset=0;this.state=0;continue;case"1":this.shiftOffset=-64;this.state=0;continue;case"2":this.shiftOffset=64;this.state=0;continue;case"3":this.shiftOffset=96;this.state=0;continue;case"4":this.shiftOffset=128;this.state=0;continue;case"5":this.shiftOffset=160;this.state=0;continue;case String.fromCharCode(this.threeQuarters):this.outputBuffer.Write(this.threeQuarters+this.shiftOffset);this.state=0;continue;case"A":++this.frameNumber;this.runningChecksum=0;this.state=0;this.inFrame=!0;continue;case"D":this.state=0;continue;case"E":this.outputBuffer.Write(this.bar+this.shiftOffset);this.state=0;continue;case"F":t&&this.onEndOfFile&&this.onEndOfFile(this.filename,this.outputBuffer.Length());this.state=0;this.inFrame=!1;continue;case"G":switch(this.state){case 1:++this.state;break;case 2:this.runningChecksum^=r;this.frameLetter=String.fromCharCode(r);this.state=0;this.ignore=!0}continue;case"I":this.ignore=!1;this.state=0;continue;case"L":this.state=0;1===this.frameNumber?this.ignore=!0:this.outputBuffer.Write(13);continue;case"T":this.state=0;continue;case"Z":switch(this.state){case 1:this.checksum=0;++this.state;this.inFrame=!1;break;case 2:this.checksum+=100*(r-48);++this.state;break;case 3:this.checksum+=10*(r-48);++this.state;break;case 4:this.checksum+=r-48;this.checksum!==this.runningChecksum&&this.onError("invalid frame checksum at frame "+this.frameNumber+" (expected "+this.checksum+", got "+this.runningChecksum+")");this.state=0;t&&this.onEndOfFrame&&this.onEndOfFrame(this.frameLetter||"")}continue;default:this.ignore=!0;this.state=0;continue}}else this.state=1;return u.length},n.prototype.GetBase64=function(){return this.outputBuffer.GetBase64()},n.prototype.parity=function(n){return((1&n)+(n>>1&1)+(n>>2&1)+(n>>3&1)+(n>>4&1)+(n>>5&1)+(n>>6&1))%2},n}();i.Downloads=u},{}],32:[function(n,t,i){var u,f,e,r,l,o,s,h,a,c;Object.defineProperty(i,"__esModule",{value:!0});i.SaveAsImage=i.Position=i.Input=i.Clock=i.Cell=i.Row=i.Buffer=i.Constants=i.ControlKeys=i.Colours=void 0;e=n("./Mode7.js");!function(n){n[n.black=0]="black";n[n.red=1]="red";n[n.green=2]="green";n[n.yellow=3]="yellow";n[n.blue=4]="blue";n[n.magenta=5]="magenta";n[n.cyan=6]="cyan";n[n.white=7]="white"}(u=i.Colours||(i.Colours={})),function(n){n.Reveal="REVEAL";n.Advance="ADVANCE";n.Hold="HOLD";n.Download="DOWNLOAD"}(f=i.ControlKeys||(i.ControlKeys={}));r=function(){function n(){}return n.MaxCols=40,n.MaxRows=24,n}();i.Constants=r;l=function(){function n(){this.Rows=new Array(r.MaxRows);this.StatusRow=new o;this.Cursor=new c({row:0,col:0});for(var n=0;n<r.MaxRows;++n)this.Rows[n]=new o;this.CursorOff()}return n.prototype.Reset=function(){this.Rows.forEach(function(n){return n.Reset()});this.CursorOff()},n.prototype.Row=function(n){return this.Rows[n]},n.prototype.Cell=function(n,t){return this.Rows[n].Cells[t]},n.prototype.CellAtPosition=function(n){return this.Rows[n.Row()].Cells[n.Column()]},n.prototype.CursorOff=function(){this.CellAtPosition(this.Cursor).IsCursor(!1)},n.prototype.CursorOn=function(n,t){this.Cursor.Row(n);this.Cursor.Column(t);this.CellAtPosition(this.Cursor).IsCursor(!0)},n.prototype.ResetCursor=function(){this.CursorOff();this.Cursor.Row(0);this.Cursor.Column(0)},n.prototype.SetStatusRow=function(n,t,i){var f,o,s;if(void 0===t&&(t=u.white),void 0===i&&(i=u.black),f=0,null!==n)for(n.length>r.MaxCols&&(n=n.substring(0,r.MaxCols));f<n.length;++f)o=this.StatusRow.Cells[f],s=e.FromKeyboard(n[f]).char,o.Fg=t,o.Bg(i),o.Character(s);for(;f<r.MaxCols;)(o=this.StatusRow.Cells[f]).Fg=t,o.Bg(i),o.Character(e.Space),++f},n}();i.Buffer=l;o=function(){function n(){this.Cells=new Array(r.MaxRows);this.IsHidden=ko.observable(!1);for(var n=0;n<r.MaxCols;++n)this.Cells[n]=new s}return n.prototype.Reset=function(){this.Cells.forEach(function(n){return n.Reset()});this.IsHidden(!1)},n.prototype.SetIsDoubleHeightLowerRow=function(){this.IsHidden(!0)},n}();i.Row=o;s=function(){function n(){var n=this;this._fg=ko.observable(u.white);this._cachedFg=u.white;this.Character=ko.observable(e.Space);this.Bg=ko.observable(u.black);this.IsFlashing=ko.observable(!1);this.IsConcealed=ko.observable(!1);this.IsDoubleHeight=ko.observable(!1);this.IsCursor=ko.observable(!1);this.IsContiguousMosaic=ko.observable(!1);this.Css=ko.computed(function(){return"bg-"+u[n.Bg()]+" fg-"+u[n._fg()]+" "+(n.IsFlashing()?"blink":"")+" "+(n.IsDoubleHeight()?"double-height":"")+" "+(n.IsConcealed()?"concealed":"")+" "+(n.IsCursor()?"cursor":"")+" "+(n.IsContiguousMosaic()?"mosaic":"")});h.Enlist(function(t){n.IsFlashing()&&(t?n._fg(n._cachedFg):n._fg(n.Bg()))})}return Object.defineProperty(n.prototype,"Fg",{get:function(){return this._fg()},set:function(n){this._fg(n);this._cachedFg=n},enumerable:!1,configurable:!0}),n.prototype.Reset=function(){this.Character(e.Space);this.Bg(0);this.Fg=u.white;this.IsFlashing(!1);this.IsConcealed(!1);this.IsDoubleHeight(!1);this.IsCursor(!1);this.IsContiguousMosaic(!1)},n.prototype.SetCharacter=function(n,t){void 0===t&&(t=!1);this.Character(n);this.IsContiguousMosaic(t)},n}();i.Cell=s;h=function(){function n(){}return n.Enlist=function(t){n.callbacks.push(t)},n.Start=function(){n.show=!1;n.clock=window.setInterval(function(){n.callbacks.forEach(function(t){t(n.show)});n.show=!n.show},1e3)},n.Stop=function(){0!=n.clock&&(window.clearInterval(n.clock),n.clock=0);n.callbacks.forEach(function(n){n(!0)})},n.callbacks=[],n.show=!1,n.clock=0,n}();i.Clock=h;a=function(n,t){var i=this;this.onAlt=n;this.onChar=t;this.OnKeyDown=function(n,t){var r=t.originalEvent;if(r.altKey)switch(r.key){case"R":case"r":i.onAlt(f.Reveal);break;case"A":case"a":i.onAlt(f.Advance);break;case"H":case"h":i.onAlt(f.Hold);break;case"D":case"d":i.onAlt(f.Download)}else switch(r.key){case"ArrowLeft":case"Left":case"Backspace":i.onChar("\b");break;case"ArrowRight":case"Right":i.onChar("\t");break;case"ArrowUp":case"Up":i.onChar("\v");break;case"ArrowDown":case"Down":i.onChar("\n");break;case"Delete":i.onChar(String.fromCharCode(127));break;case"Enter":i.onChar("_");break;case"Escape":i.onChar(String.fromCharCode(27));break;default:1==r.key.length&&("#"==r.key?i.onChar("_"):i.onChar(r.key))}}};i.Input=a;c=function(n){this.Row=ko.observable(n.row);this.Column=ko.observable(n.col)};i.Position=c;i.SaveAsImage=function(n,t,i,u){var f,y,c,e,p,w,o;void 0===i&&(i=600);void 0===u&&(u=480);var b=["black","rgb(255, 0, 0)","rgb(0, 255, 0)","rgb(255, 255, 0)","rgb(0, 0, 255)","rgb(255, 0, 255)","rgb(0, 255, 255)","white"],l=Math.floor(i/r.MaxCols),s=Math.floor(u/r.MaxRows),a=2*s;t.height=u;t.width=i;f=t.getContext("2d");f.textBaseline="bottom";for(var k=0,v=0,h=0;h<r.MaxRows;++h)if(!n.Row(h).IsHidden()){for(y=n.Row(h).Cells.some(function(n){return n.IsDoubleHeight()}),y?(v+=a,f.font=a+"px bedstead-double-height"):(v+=s,f.font=s+"px bedstead"),c=0;c<r.MaxCols;++c)e=n.Cell(h,c),p=c*l,f.fillStyle=b[e.Bg()],f.fillRect(p,k,l,y?a:s),f.fillStyle=b[e.Fg],f.fillText(e.Character(),p,v,l),e.IsContiguousMosaic()&&f.fillText(e.Character(),p-1,v,l);k+=y?a:s}return w="data:image/png;base64,",o=t.toDataURL(),0==o.indexOf(w)&&(o=o.substring(w.length)),{mime:"image/png",b64:o,size:4*Math.ceil(o.length/3),extension:".png"}}},{"./Mode7.js":27}],33:[function(n,t,i){var e=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(n){f(n)}}function s(n){try{e(r["throw"](n))}catch(n){f(n)}}function e(n){var t;n.done?u(n.value):(t=n.value,t instanceof i?t:new i(function(n){n(t)})).then(o,s)}e((r=r.apply(n,t||[])).next())})},o=this&&this.__generator||function(n,t){function o(e){return function(o){return function(e){if(f)throw new TypeError("Generator is already executing.");for(;r;)try{if(f=1,u&&(i=2&e[0]?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;switch(u=0,i&&(e=[2&e[0],i.value]),e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&&i[i.length-1])||6!==e[0]&&2!==e[0])){r=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(6===e[0]&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(n){e=[6,n];u=0}finally{f=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,o])}}var f,u,i,e,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:o(0),"throw":o(1),"return":o(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e},f;Object.defineProperty(i,"__esModule",{value:!0});i.Main=i.ViewDataView=void 0;var s=n("./Mullard.js"),r=n("./Terminal.js"),h=n("./Storage.js"),c=n("./Telesoft.js"),l=n("./Mode7.js"),a=n("./Hub.js"),v=n("./Logger.js"),y=n("./SvgRenderer.js"),u=function(){this.Buffer=new r.Buffer;this.IsRevealed=ko.observable(!1);this.ShowGrid=ko.observable(!1);this.EnableFlash=ko.observable(!1);this.Decoder=new s.SAA5050(this.Buffer);this.Constants=r.Constants;this.SVG=new y.SvgBufferTransform(this.Buffer,this.ShowGrid)};i.ViewDataView=u;f=function(){function n(){var n=this;this.defaultHeader="Click 'Connect'";this.mainViewElement=document.getElementById("mainView");this.downloadsElement=document.getElementById("downloads");this.teletextCommands={HOLD:"H",ADVANCE:"."};this.viewdataCommands={NEXT:"#",PREVIOUS:"*#"};this.Header=ko.observable(this.defaultHeader);this.UserStats=ko.observable(null);this.Services=ko.observableArray();this.SelectedService=ko.observable();this.IsViewFocused=ko.observable(!0);this.IsConnected=ko.observable(!1);this.IsViewdata=ko.observable(!0);this.IsTeletext=ko.observable(!1);this.Postamble=ko.observable(null);this.Downloading=ko.observable(!1);this.Input=ko.observable();this.Downloads=ko.observableArray();this.SavedFrames=ko.observableArray();this.EnableLogoff=ko.computed(function(){return n.IsConnected()&&null!=n.Postamble()});this.EnableCommands=ko.computed(function(){return n.IsConnected()&&!n.Downloading()});this.EnableDownload=ko.observable(!1);this.Log=new v.Log;this.View=new u;this.Storage=new h.Storage;this.Keyboard=new r.Input(function(t){switch(t){case r.ControlKeys.Hold:n.Command(n.teletextCommands.HOLD);break;case r.ControlKeys.Advance:n.Command(n.teletextCommands.ADVANCE);break;case r.ControlKeys.Reveal:n.ToggleReveal();break;case r.ControlKeys.Download:n.Download()}},function(t){n.Command(t)});this.Downloader=new c.Downloads(function(t){n.Status.unexpected();n.Log.Error(t)},function(t){n.send("z"==t?"0":"#")},function(t,i){n.Downloading(!1);n.EnableDownload(!1);var r=n.Downloader.GetBase64();n.Downloads.push(n.Storage.AddDownload(t,i,r,n.Storage.MimeTypes.Binary));n.Log.Info("'"+t+"' downloaded");n.send("#");n.scrollToDownloads()});this.Hub=new a.Hub({received:function(t){if(null!=t)if(n.View.Decoder.DecodeBase64(t),n.Downloading())try{n.Downloader.Decode(t)}catch(t){n.Log.Error(t);n.Status.unexpected()}else try{n.EnableDownload(n.Downloader.TryDecodeHeaderFrame(t))}catch(n){}},stats:function(t){t.active?1==t.active?n.UserStats("1 user online"):n.UserStats(t.active+" users online"):n.UserStats("0 users online")},exception:function(t){n.Status.error(t);n.Log.Error(t)}});this.Status={success:function(t){n.View.Buffer.SetStatusRow(t,2,0)},info:function(t){n.View.Buffer.SetStatusRow(t,7,0)},error:function(t){n.View.Buffer.SetStatusRow(t,1,0)},unexpected:function(){n.View.Buffer.SetStatusRow("An error occurred",1,0)},warning:function(t){n.View.Buffer.SetStatusRow(t,3,0)},clear:function(){n.View.Buffer.SetStatusRow(null,0,0)}};this.OnKeyDown=function(t,i){return"Enter"!=i.originalEvent.key||(n.Send(),!1)};this.ToggleConnect=_.throttle(function(){n.IsViewFocused(!0);n.Status.clear();n.Hub.Connect().then(function(){return n.IsConnected()?n.disconnect():n.connect()})["catch"](function(t){n.Log.Error(t)})},1e3);this.ToggleReveal=_.throttle(function(){n.IsViewFocused(!0);n.View.IsRevealed(!n.View.IsRevealed())},1e3);this.Send=_.throttle(function(){if(n.IsConnected()){n.IsViewFocused(!0);var t=n.Input()||"";t.endsWith("#")||(t+="#");n.Command(t)}},1e3);this.Command=function(t){null!=t&&n.IsConnected()&&(n.IsViewFocused(!0),n.Downloader.Reset(),n.Status.clear(),n.Hub.Connect().then(function(){n.send(t)})["catch"](function(t){n.Log.Error(t)}))};this.Logoff=function(){n.IsConnected()&&(n.IsViewFocused(!0),n.Downloader.Reset(),n.Status.clear(),n.Hub.Connect().then(function(){null!=n.Postamble()&&n.send(n.Postamble())})["catch"](function(t){n.Log.Error(t)}))};this.Download=function(){n.EnableDownload()&&n.IsConnected()&&(n.IsViewFocused(!0),n.Status.clear(),n.Hub.Connect().then(function(){n.Downloading(!0);n.send("#")})["catch"](function(t){n.Log.Error(t)}))};this.RemoveDownload=_.throttle(function(t){n.IsViewFocused(!0);n.Storage.RemoveDownloadAt(t);var i=n.Downloads();i.splice(t,1);n.Downloads(i)},1e3);this.SaveFrame=_.throttle(function(){var t;if(n.IsViewFocused(!0),t=n.View.Decoder.GetFrameAsBase64(),null!=t){var i=document.getElementById("Canvas"),u=r.SaveAsImage(n.View.Buffer,i,160,125),f=n.Storage.AddFrame(t,u);n.SavedFrames.push(f);n.FrameSlider.refresh()}},1e3);this.LoadSavedFrame=_.throttle(function(t){n.IsViewFocused(!0);var i=n.Storage.GetFrameAt(t);n.View.Decoder.Load(i.b64)},1e3);this.Clipboard=ko.observable();this.CopySavedFrame=_.throttle(function(t){n.IsViewFocused(!0);var i=n.Storage.GetFrameAt(t);n.Clipboard(i.b64);document.getElementById("Clipboard").select();document.execCommand("copy")},1e3);this.RemoveSavedFrame=_.throttle(function(t){n.IsViewFocused(!0);n.Storage.RemoveFrameAt(t);var i=n.SavedFrames();i.splice(t,1);n.SavedFrames(i);n.FrameSlider.refresh()},1e3);this.SaveAsImage=_.throttle(function(){n.IsViewFocused(!0);var i=document.getElementById("Canvas"),t=r.SaveAsImage(n.View.Buffer,i),u=""+n.View.Decoder.FrameNumber()+t.extension,f=n.Storage.AddDownload(u,t.size,t.b64,t.mime);n.Downloads.push(f);n.scrollToDownloads()},1e3);this.FullScreen=_.throttle(function(){return e(n,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return this.mainViewElement.requestFullscreen?(this.View.ShowGrid(!1),[4,this.mainViewElement.requestFullscreen()]):[3,2];case 1:n.sent();this.IsViewFocused(!0);n.label=2;case 2:return[2]}})})},1e3);this.Storage.Migrate();this.Downloads(this.Storage.Downloads());this.View.EnableFlash(this.Storage.EnableFlashing);this.View.EnableFlash.subscribe(function(t){n.Storage.EnableFlashing=t;t?r.Clock.Start():r.Clock.Stop()});this.initGestures();this.View.EnableFlash()&&r.Clock.Start();this.FrameSlider=$("#saved-frames").lightSlider({item:6,autoWidth:!0});this.SavedFrames(this.Storage.Frames());setTimeout(function(){n.FrameSlider.refresh()},0);this.Hub.Connect().then(function(){return n.Hub.Server.services()}).then(function(t){return n.Services(t),n.checkConnection(!0)})["catch"](function(){n.Log.Info("No existing connection")});[this.View.IsRevealed,this.View.ShowGrid,this.View.EnableFlash].forEach(function(t){return t.subscribe(function(){n.IsViewFocused(!0)})})}return n.prototype.checkConnection=function(n){var t=this;return new Promise(function(i,r){t.Hub.Server.isOpen().then(function(u){u.isOpen?(t.SelectedService(u.service),t.onConnected(u),t.Log.Info("Already connected"),n&&(t.Log.Info("Reloading frame. Sending '*00#'"),t.send("*00#")),i()):(t.IsConnected()&&(t.Log.Warning("The session was closed due to inactivity or an error on the remote host. Please re-connect"),t.Status.warning("Session closed: inactive/remote error")),t.onDisconnected(),r())})["catch"](function(n){t.Log.Error(n);t.Status.unexpected();t.onDisconnected();r(n)})})},n.prototype.send=function(n){var t=this,i=l.FromKeyboardString(n),r;this.Log.Info("Sending '"+n+"' encoded as '"+i+"'");r=btoa(i);this.Hub.Server.asyncWrite(r)["catch"](function(){return t.Log.Error("Send failed. Checking connection"),t.checkConnection(!1)})["catch"](function(){t.Log.Info("No existing connection")})},n.prototype.connect=function(){var n=this,t=this.SelectedService();return this.Log.Info("Connecting to "+t),this.checkConnection(!0)["catch"](function(){return n.Hub.Server.open(t).then(function(t){n.Log.Success("Connected to "+t.host+" on port "+t.port);n.onConnected(t)})["catch"](function(t){n.Log.Error(t);n.Status.unexpected()})})},n.prototype.disconnect=function(){var n=this;return this.Log.Info("Disconnecting..."),this.Hub.Server.close().then(function(){n.Log.Success("Disconnected");n.onDisconnected()})["catch"](function(t){n.Log.Error(t);n.onDisconnected()})},n.prototype.initGestures=function(){var n=this,t=new Hammer.Manager(this.mainViewElement);t.add(new Hammer.Tap({event:"singletap",taps:1}));t.add(new Hammer.Pan({event:"panleft",direction:Hammer.DIRECTION_LEFT}));t.add(new Hammer.Pan({event:"panright",direction:Hammer.DIRECTION_RIGHT}));t.add(new Hammer.Pan({event:"pandown",direction:Hammer.DIRECTION_DOWN}));t.on("panleft",_.debounce(function(){n.IsConnected()&&(n.IsTeletext()?n.Command(n.teletextCommands.ADVANCE):n.Command(n.viewdataCommands.NEXT))},500));t.on("panright",_.debounce(function(){n.IsConnected()&&(n.IsTeletext()||n.Command(n.viewdataCommands.PREVIOUS))},500));t.on("pandown",_.debounce(function(){document.fullscreenElement&&document.exitFullscreen()},500));t.on("singletap",function(){n.IsConnected()&&n.IsTeletext()&&n.Command(n.teletextCommands.HOLD)})},n.prototype.onConnected=function(n){this.Header(n.host+":"+n.port);this.IsConnected(!0);this.Postamble(n.postamble);this.IsViewdata("Viewdata"==n.mode);this.IsTeletext("Teletext"==n.mode);this.Hub.Server.asyncRead()},n.prototype.onDisconnected=function(){this.Header(this.defaultHeader);this.IsConnected(!1);this.EnableDownload(!1);this.Postamble(null)},n.prototype.scrollToDownloads=function(){var n=this.downloadsElement.getBoundingClientRect().top+window.scrollY;window.scroll({top:n,behavior:"smooth"})},n}();i.Main=f},{"./Hub.js":24,"./Logger.js":25,"./Mode7.js":27,"./Mullard.js":28,"./Storage.js":29,"./SvgRenderer.js":30,"./Telesoft.js":31,"./Terminal.js":32}],34:[function(n,t,i){function o(n){var i=n.length,t;if(i%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return t=n.indexOf("="),-1===t&&(t=i),[t,t===i?0:4-t%4]}function c(n,t,i){for(var e,f,o=[],r=t;r<i;r+=3)e=(n[r]<<16&16711680)+(n[r+1]<<8&65280)+(255&n[r+2]),o.push(u[(f=e)>>18&63]+u[f>>12&63]+u[f>>6&63]+u[63&f]);return o.join("")}i.byteLength=function(n){var t=o(n),r=t[0],i=t[1];return 3*(r+i)/4-i};i.toByteArray=function(n){for(var i,c=o(n),h=c[0],e=c[1],u=new s(function(n,t,i){return 3*(t+i)/4-i}(0,h,e)),f=0,l=e>0?h-4:h,t=0;t<l;t+=4)i=r[n.charCodeAt(t)]<<18|r[n.charCodeAt(t+1)]<<12|r[n.charCodeAt(t+2)]<<6|r[n.charCodeAt(t+3)],u[f++]=i>>16&255,u[f++]=i>>8&255,u[f++]=255&i;return 2===e&&(i=r[n.charCodeAt(t)]<<2|r[n.charCodeAt(t+1)]>>4,u[f++]=255&i),1===e&&(i=r[n.charCodeAt(t)]<<10|r[n.charCodeAt(t+1)]<<4|r[n.charCodeAt(t+2)]>>2,u[f++]=i>>8&255,u[f++]=255&i),u};i.fromByteArray=function(n){for(var t,i=n.length,e=i%3,f=[],o=16383,r=0,s=i-e;r<s;r+=o)f.push(c(n,r,r+o>s?s:r+o));return 1===e?(t=n[i-1],f.push(u[t>>2]+u[t<<4&63]+"==")):2===e&&(t=(n[i-2]<<8)+n[i-1],f.push(u[t>>10]+u[t>>4&63]+u[t<<2&63]+"=")),f.join("")};for(var u=[],r=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=0,h=e.length;f<h;++f)u[f]=e[f],r[e.charCodeAt(f)]=f;r["-".charCodeAt(0)]=62;r["_".charCodeAt(0)]=63},{}],35:[function(n,t,i){(function(){(function(){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
function f(n){if(n>h)throw new RangeError('The value "'+n+'" is invalid for option "size"');var i=new Uint8Array(n);return i.__proto__=t.prototype,i}function t(n,t,i){if("number"==typeof n){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return a(n)}return k(n,t,i)}function k(n,i,r){var u,e;if("string"==typeof n)return function(n,i){if("string"==typeof i&&""!==i||(i="utf8"),!t.isEncoding(i))throw new TypeError("Unknown encoding: "+i);var u=0|g(n,i),r=f(u),e=r.write(n,i);return e!==u&&(r=r.slice(0,e)),r}(n,i);if(ArrayBuffer.isView(n))return v(n);if(null==n)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof n);if(s(n,ArrayBuffer)||n&&s(n.buffer,ArrayBuffer))return function(n,i,r){if(i<0||n.byteLength<i)throw new RangeError('"offset" is outside of buffer bounds');if(n.byteLength<i+(r||0))throw new RangeError('"length" is outside of buffer bounds');var u;return u=void 0===i&&void 0===r?new Uint8Array(n):void 0===r?new Uint8Array(n,i):new Uint8Array(n,i,r),u.__proto__=t.prototype,u}(n,i,r);if("number"==typeof n)throw new TypeError('The "value" argument must not be of type number. Received type number');if(u=n.valueOf&&n.valueOf(),null!=u&&u!==n)return t.from(u,i,r);if(e=function(n){if(t.isBuffer(n)){var r=0|y(n.length),i=f(r);return 0===i.length||n.copy(i,0,0,r),i}return void 0!==n.length?"number"!=typeof n.length||b(n.length)?f(0):v(n):"Buffer"===n.type&&Array.isArray(n.data)?v(n.data):void 0}(n),e)return e;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof n[Symbol.toPrimitive])return t.from(n[Symbol.toPrimitive]("string"),i,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof n);}function d(n){if("number"!=typeof n)throw new TypeError('"size" argument must be of type number');if(n<0)throw new RangeError('The value "'+n+'" is invalid for option "size"');}function a(n){return d(n),f(n<0?0:0|y(n))}function v(n){for(var i=n.length<0?0:0|y(n.length),r=f(i),t=0;t<i;t+=1)r[t]=255&n[t];return r}function y(n){if(n>=h)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+h.toString(16)+" bytes");return 0|n}function g(n,i){var r,u,f;if(t.isBuffer(n))return n.length;if(ArrayBuffer.isView(n)||s(n,ArrayBuffer))return n.byteLength;if("string"!=typeof n)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof n);if(r=n.length,u=arguments.length>2&&!0===arguments[2],!u&&0===r)return 0;for(f=!1;;)switch(i){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return w(n).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return st(n).length;default:if(f)return u?-1:w(n).length;i=(""+i).toLowerCase();f=!0}}function ht(n,t,i){var r=!1;if(((void 0===t||t<0)&&(t=0),t>this.length)||((void 0===i||i>this.length)&&(i=this.length),i<=0)||(i>>>=0)<=(t>>>=0))return"";for(n||(n="utf8");;)switch(n){case"hex":return kt(this,t,i);case"utf8":case"utf-8":return rt(this,t,i);case"ascii":return wt(this,t,i);case"latin1":case"binary":return bt(this,t,i);case"base64":return pt(this,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return dt(this,t,i);default:if(r)throw new TypeError("Unknown encoding: "+n);n=(n+"").toLowerCase();r=!0}}function o(n,t,i){var r=n[t];n[t]=n[i];n[i]=r}function nt(n,i,r,u,f){if(0===n.length)return-1;if("string"==typeof r?(u=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),b(r=+r)&&(r=f?0:n.length-1),r<0&&(r=n.length+r),r>=n.length){if(f)return-1;r=n.length-1}else if(r<0){if(!f)return-1;r=0}if("string"==typeof i&&(i=t.from(i,u)),t.isBuffer(i))return 0===i.length?-1:tt(n,i,r,u,f);if("number"==typeof i)return i&=255,"function"==typeof Uint8Array.prototype.indexOf?f?Uint8Array.prototype.indexOf.call(n,i,r):Uint8Array.prototype.lastIndexOf.call(n,i,r):tt(n,[i],r,u,f);throw new TypeError("val must be string, number or Buffer");}function tt(n,t,i,r,u){function l(n,t){return 1===h?n[t]:n.readUInt16BE(t*h)}var f,h=1,c=n.length,o=t.length,e,a,s;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(n.length<2||t.length<2)return-1;h=2;c/=2;o/=2;i/=2}if(u)for(e=-1,f=i;f<c;f++)if(l(n,f)===l(t,-1===e?0:f-e)){if(-1===e&&(e=f),f-e+1===o)return e*h}else-1!==e&&(f-=f-e),e=-1;else for(i+o>c&&(i=c-o),f=i;f>=0;f--){for(a=!0,s=0;s<o;s++)if(l(n,f+s)!==l(t,s)){a=!1;break}if(a)return f}return-1}function ct(n,t,i,r){var f,e,u,o;for(i=Number(i)||0,f=n.length-i,r?(r=Number(r))>f&&(r=f):r=f,e=t.length,r>e/2&&(r=e/2),u=0;u<r;++u){if(o=parseInt(t.substr(2*u,2),16),b(o))return u;n[i+u]=o}return u}function lt(n,t,i,r){return l(w(t,n.length-i),n,i,r)}function it(n,t,i,r){return l(function(n){for(var i=[],t=0;t<n.length;++t)i.push(255&n.charCodeAt(t));return i}(t),n,i,r)}function at(n,t,i,r){return it(n,t,i,r)}function vt(n,t,i,r){return l(st(t),n,i,r)}function yt(n,t,i,r){return l(function(n,t){for(var u,f,e,i=[],r=0;r<n.length&&!((t-=2)<0);++r)f=(u=n.charCodeAt(r))>>8,e=u%256,i.push(e),i.push(f);return i}(t,n.length-i),n,i,r)}function pt(n,t,i){return 0===t&&i===n.length?c.fromByteArray(n):c.fromByteArray(n.slice(t,i))}function rt(n,t,i){var h,u;for(i=Math.min(n.length,i),h=[],u=t;u<i;){var e,s,l,f,o=n[u],r=null,c=o>239?4:o>223?3:o>191?2:1;if(u+c<=i)switch(c){case 1:o<128&&(r=o);break;case 2:128==(192&(e=n[u+1]))&&(f=(31&o)<<6|63&e)>127&&(r=f);break;case 3:e=n[u+1];s=n[u+2];128==(192&e)&&128==(192&s)&&(f=(15&o)<<12|(63&e)<<6|63&s)>2047&&(f<55296||f>57343)&&(r=f);break;case 4:e=n[u+1];s=n[u+2];l=n[u+3];128==(192&e)&&128==(192&s)&&128==(192&l)&&(f=(15&o)<<18|(63&e)<<12|(63&s)<<6|63&l)>65535&&f<1114112&&(r=f)}null===r?(r=65533,c=1):r>65535&&(r-=65536,h.push(r>>>10&1023|55296),r=56320|1023&r);h.push(r);u+=c}return function(n){var r=n.length,i,t;if(r<=p)return String.fromCharCode.apply(String,n);for(i="",t=0;t<r;)i+=String.fromCharCode.apply(String,n.slice(t,t+=p));return i}(h)}function wt(n,t,i){var u="",r;for(i=Math.min(n.length,i),r=t;r<i;++r)u+=String.fromCharCode(127&n[r]);return u}function bt(n,t,i){var u="",r;for(i=Math.min(n.length,i),r=t;r<i;++r)u+=String.fromCharCode(n[r]);return u}function kt(n,t,i){var f=n.length,u,r;for((!t||t<0)&&(t=0),(!i||i<0||i>f)&&(i=f),u="",r=t;r<i;++r)u+=gt(n[r]);return u}function dt(n,t,i){for(var u=n.slice(t,i),f="",r=0;r<u.length;r+=2)f+=String.fromCharCode(u[r]+256*u[r+1]);return f}function r(n,t,i){if(n%1!=0||n<0)throw new RangeError("offset is not uint");if(n+t>i)throw new RangeError("Trying to access beyond buffer length");}function u(n,i,r,u,f,e){if(!t.isBuffer(n))throw new TypeError('"buffer" argument must be a Buffer instance');if(i>f||i<e)throw new RangeError('"value" argument is out of bounds');if(r+u>n.length)throw new RangeError("Index out of range");}function ut(n,t,i,r){if(i+r>n.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range");}function ft(n,t,i,r,u){return t=+t,i>>>=0,u||ut(n,0,i,4),e.write(n,t,i,r,23,4),i+4}function et(n,t,i,r,u){return t=+t,i>>>=0,u||ut(n,0,i,8),e.write(n,t,i,r,52,8),i+8}function gt(n){return n<16?"0"+n.toString(16):n.toString(16)}function w(n,t){var i;t=t||1/0;for(var e=n.length,u=null,r=[],f=0;f<e;++f){if((i=n.charCodeAt(f))>55295&&i<57344){if(!u){if(i>56319){(t-=3)>-1&&r.push(239,191,189);continue}if(f+1===e){(t-=3)>-1&&r.push(239,191,189);continue}u=i;continue}if(i<56320){(t-=3)>-1&&r.push(239,191,189);u=i;continue}i=65536+(u-55296<<10|i-56320)}else u&&(t-=3)>-1&&r.push(239,191,189);if(u=null,i<128){if((t-=1)<0)break;r.push(i)}else if(i<2048){if((t-=2)<0)break;r.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;r.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;r.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return r}function st(n){return c.toByteArray(function(n){if((n=(n=n.split("=")[0]).trim().replace(ot,"")).length<2)return"";for(;n.length%4!=0;)n+="=";return n}(n))}function l(n,t,i,r){for(var u=0;u<r&&!(u+i>=t.length||u>=n.length);++u)t[u+i]=n[u];return u}function s(n,t){return n instanceof t||null!=n&&null!=n.constructor&&null!=n.constructor.name&&n.constructor.name===t.name}function b(n){return n!=n}var c,e,h,p,ot;c=n("base64-js");e=n("ieee754");i.Buffer=t;i.SlowBuffer=function(n){return+n!=n&&(n=0),t.alloc(+n)};i.INSPECT_MAX_BYTES=50;h=2147483647;i.kMaxLength=h;t.TYPED_ARRAY_SUPPORT=function(){try{var n=new Uint8Array(1);return n.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===n.foo()}catch(n){return!1}}();t.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");Object.defineProperty(t.prototype,"parent",{enumerable:!0,get:function(){if(t.isBuffer(this))return this.buffer}});Object.defineProperty(t.prototype,"offset",{enumerable:!0,get:function(){if(t.isBuffer(this))return this.byteOffset}});"undefined"!=typeof Symbol&&null!=Symbol.species&&t[Symbol.species]===t&&Object.defineProperty(t,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1});t.poolSize=8192;t.from=function(n,t,i){return k(n,t,i)};t.prototype.__proto__=Uint8Array.prototype;t.__proto__=Uint8Array;t.alloc=function(n,t,i){return function(n,t,i){return d(n),n<=0?f(n):void 0!==t?"string"==typeof i?f(n).fill(t,i):f(n).fill(t):f(n)}(n,t,i)};t.allocUnsafe=function(n){return a(n)};t.allocUnsafeSlow=function(n){return a(n)};t.isBuffer=function(n){return null!=n&&!0===n._isBuffer&&n!==t.prototype};t.compare=function(n,i){if(s(n,Uint8Array)&&(n=t.from(n,n.offset,n.byteLength)),s(i,Uint8Array)&&(i=t.from(i,i.offset,i.byteLength)),!t.isBuffer(n)||!t.isBuffer(i))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(n===i)return 0;for(var u=n.length,f=i.length,r=0,e=Math.min(u,f);r<e;++r)if(n[r]!==i[r]){u=n[r];f=i[r];break}return u<f?-1:f<u?1:0};t.isEncoding=function(n){switch(String(n).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};t.concat=function(n,i){var r,f,e,u;if(!Array.isArray(n))throw new TypeError('"list" argument must be an Array of Buffers');if(0===n.length)return t.alloc(0);if(void 0===i)for(i=0,r=0;r<n.length;++r)i+=n[r].length;for(f=t.allocUnsafe(i),e=0,r=0;r<n.length;++r){if(u=n[r],s(u,Uint8Array)&&(u=t.from(u)),!t.isBuffer(u))throw new TypeError('"list" argument must be an Array of Buffers');u.copy(f,e);e+=u.length}return f};t.byteLength=g;t.prototype._isBuffer=!0;t.prototype.swap16=function(){var t=this.length,n;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(n=0;n<t;n+=2)o(this,n,n+1);return this};t.prototype.swap32=function(){var t=this.length,n;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(n=0;n<t;n+=4)o(this,n,n+3),o(this,n+1,n+2);return this};t.prototype.swap64=function(){var t=this.length,n;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(n=0;n<t;n+=8)o(this,n,n+7),o(this,n+1,n+6),o(this,n+2,n+5),o(this,n+3,n+4);return this};t.prototype.toString=function(){var n=this.length;return 0===n?"":0===arguments.length?rt(this,0,n):ht.apply(this,arguments)};t.prototype.toLocaleString=t.prototype.toString;t.prototype.equals=function(n){if(!t.isBuffer(n))throw new TypeError("Argument must be a Buffer");return this===n||0===t.compare(this,n)};t.prototype.inspect=function(){var n="",t=i.INSPECT_MAX_BYTES;return n=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(n+=" ... "),"<Buffer "+n+">"};t.prototype.compare=function(n,i,r,u,f){if(s(n,Uint8Array)&&(n=t.from(n,n.offset,n.byteLength)),!t.isBuffer(n))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof n);if(void 0===i&&(i=0),void 0===r&&(r=n?n.length:0),void 0===u&&(u=0),void 0===f&&(f=this.length),i<0||r>n.length||u<0||f>this.length)throw new RangeError("out of range index");if(u>=f&&i>=r)return 0;if(u>=f)return-1;if(i>=r)return 1;if(this===n)return 0;for(var o=(f>>>=0)-(u>>>=0),h=(r>>>=0)-(i>>>=0),a=Math.min(o,h),c=this.slice(u,f),l=n.slice(i,r),e=0;e<a;++e)if(c[e]!==l[e]){o=c[e];h=l[e];break}return o<h?-1:h<o?1:0};t.prototype.includes=function(n,t,i){return-1!==this.indexOf(n,t,i)};t.prototype.indexOf=function(n,t,i){return nt(this,n,t,i,!0)};t.prototype.lastIndexOf=function(n,t,i){return nt(this,n,t,i,!1)};t.prototype.write=function(n,t,i,r){var u,f;if(void 0===t)r="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)r=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0;isFinite(i)?(i>>>=0,void 0===r&&(r="utf8")):(r=i,i=void 0)}if(u=this.length-t,(void 0===i||i>u)&&(i=u),n.length>0&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");for(r||(r="utf8"),f=!1;;)switch(r){case"hex":return ct(this,n,t,i);case"utf8":case"utf-8":return lt(this,n,t,i);case"ascii":return it(this,n,t,i);case"latin1":case"binary":return at(this,n,t,i);case"base64":return vt(this,n,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return yt(this,n,t,i);default:if(f)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase();f=!0}};t.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};p=4096;t.prototype.slice=function(n,i){var r=this.length,u;return(n=~~n)<0?(n+=r)<0&&(n=0):n>r&&(n=r),(i=void 0===i?r:~~i)<0?(i+=r)<0&&(i=0):i>r&&(i=r),i<n&&(i=n),u=this.subarray(n,i),u.__proto__=t.prototype,u};t.prototype.readUIntLE=function(n,t,i){n>>>=0;t>>>=0;i||r(n,t,this.length);for(var u=this[n],f=1,e=0;++e<t&&(f*=256);)u+=this[n+e]*f;return u};t.prototype.readUIntBE=function(n,t,i){n>>>=0;t>>>=0;i||r(n,t,this.length);for(var u=this[n+--t],f=1;t>0&&(f*=256);)u+=this[n+--t]*f;return u};t.prototype.readUInt8=function(n,t){return n>>>=0,t||r(n,1,this.length),this[n]};t.prototype.readUInt16LE=function(n,t){return n>>>=0,t||r(n,2,this.length),this[n]|this[n+1]<<8};t.prototype.readUInt16BE=function(n,t){return n>>>=0,t||r(n,2,this.length),this[n]<<8|this[n+1]};t.prototype.readUInt32LE=function(n,t){return n>>>=0,t||r(n,4,this.length),(this[n]|this[n+1]<<8|this[n+2]<<16)+16777216*this[n+3]};t.prototype.readUInt32BE=function(n,t){return n>>>=0,t||r(n,4,this.length),16777216*this[n]+(this[n+1]<<16|this[n+2]<<8|this[n+3])};t.prototype.readIntLE=function(n,t,i){n>>>=0;t>>>=0;i||r(n,t,this.length);for(var u=this[n],f=1,e=0;++e<t&&(f*=256);)u+=this[n+e]*f;return u>=(f*=128)&&(u-=Math.pow(2,8*t)),u};t.prototype.readIntBE=function(n,t,i){n>>>=0;t>>>=0;i||r(n,t,this.length);for(var f=t,e=1,u=this[n+--f];f>0&&(e*=256);)u+=this[n+--f]*e;return u>=(e*=128)&&(u-=Math.pow(2,8*t)),u};t.prototype.readInt8=function(n,t){return n>>>=0,t||r(n,1,this.length),128&this[n]?-1*(256-this[n]):this[n]};t.prototype.readInt16LE=function(n,t){n>>>=0;t||r(n,2,this.length);var i=this[n]|this[n+1]<<8;return 32768&i?4294901760|i:i};t.prototype.readInt16BE=function(n,t){n>>>=0;t||r(n,2,this.length);var i=this[n+1]|this[n]<<8;return 32768&i?4294901760|i:i};t.prototype.readInt32LE=function(n,t){return n>>>=0,t||r(n,4,this.length),this[n]|this[n+1]<<8|this[n+2]<<16|this[n+3]<<24};t.prototype.readInt32BE=function(n,t){return n>>>=0,t||r(n,4,this.length),this[n]<<24|this[n+1]<<16|this[n+2]<<8|this[n+3]};t.prototype.readFloatLE=function(n,t){return n>>>=0,t||r(n,4,this.length),e.read(this,n,!0,23,4)};t.prototype.readFloatBE=function(n,t){return n>>>=0,t||r(n,4,this.length),e.read(this,n,!1,23,4)};t.prototype.readDoubleLE=function(n,t){return n>>>=0,t||r(n,8,this.length),e.read(this,n,!0,52,8)};t.prototype.readDoubleBE=function(n,t){return n>>>=0,t||r(n,8,this.length),e.read(this,n,!1,52,8)};t.prototype.writeUIntLE=function(n,t,i,r){(n=+n,t>>>=0,i>>>=0,r)||u(this,n,t,i,Math.pow(2,8*i)-1,0);var f=1,e=0;for(this[t]=255&n;++e<i&&(f*=256);)this[t+e]=n/f&255;return t+i};t.prototype.writeUIntBE=function(n,t,i,r){(n=+n,t>>>=0,i>>>=0,r)||u(this,n,t,i,Math.pow(2,8*i)-1,0);var f=i-1,e=1;for(this[t+f]=255&n;--f>=0&&(e*=256);)this[t+f]=n/e&255;return t+i};t.prototype.writeUInt8=function(n,t,i){return n=+n,t>>>=0,i||u(this,n,t,1,255,0),this[t]=255&n,t+1};t.prototype.writeUInt16LE=function(n,t,i){return n=+n,t>>>=0,i||u(this,n,t,2,65535,0),this[t]=255&n,this[t+1]=n>>>8,t+2};t.prototype.writeUInt16BE=function(n,t,i){return n=+n,t>>>=0,i||u(this,n,t,2,65535,0),this[t]=n>>>8,this[t+1]=255&n,t+2};t.prototype.writeUInt32LE=function(n,t,i){return n=+n,t>>>=0,i||u(this,n,t,4,4294967295,0),this[t+3]=n>>>24,this[t+2]=n>>>16,this[t+1]=n>>>8,this[t]=255&n,t+4};t.prototype.writeUInt32BE=function(n,t,i){return n=+n,t>>>=0,i||u(this,n,t,4,4294967295,0),this[t]=n>>>24,this[t+1]=n>>>16,this[t+2]=n>>>8,this[t+3]=255&n,t+4};t.prototype.writeIntLE=function(n,t,i,r){var f;(n=+n,t>>>=0,r)||(f=Math.pow(2,8*i-1),u(this,n,t,i,f-1,-f));var e=0,s=1,o=0;for(this[t]=255&n;++e<i&&(s*=256);)n<0&&0===o&&0!==this[t+e-1]&&(o=1),this[t+e]=(n/s>>0)-o&255;return t+i};t.prototype.writeIntBE=function(n,t,i,r){var e;(n=+n,t>>>=0,r)||(e=Math.pow(2,8*i-1),u(this,n,t,i,e-1,-e));var f=i-1,s=1,o=0;for(this[t+f]=255&n;--f>=0&&(s*=256);)n<0&&0===o&&0!==this[t+f+1]&&(o=1),this[t+f]=(n/s>>0)-o&255;return t+i};t.prototype.writeInt8=function(n,t,i){return n=+n,t>>>=0,i||u(this,n,t,1,127,-128),n<0&&(n=255+n+1),this[t]=255&n,t+1};t.prototype.writeInt16LE=function(n,t,i){return n=+n,t>>>=0,i||u(this,n,t,2,32767,-32768),this[t]=255&n,this[t+1]=n>>>8,t+2};t.prototype.writeInt16BE=function(n,t,i){return n=+n,t>>>=0,i||u(this,n,t,2,32767,-32768),this[t]=n>>>8,this[t+1]=255&n,t+2};t.prototype.writeInt32LE=function(n,t,i){return n=+n,t>>>=0,i||u(this,n,t,4,2147483647,-2147483648),this[t]=255&n,this[t+1]=n>>>8,this[t+2]=n>>>16,this[t+3]=n>>>24,t+4};t.prototype.writeInt32BE=function(n,t,i){return n=+n,t>>>=0,i||u(this,n,t,4,2147483647,-2147483648),n<0&&(n=4294967295+n+1),this[t]=n>>>24,this[t+1]=n>>>16,this[t+2]=n>>>8,this[t+3]=255&n,t+4};t.prototype.writeFloatLE=function(n,t,i){return ft(this,n,t,!0,i)};t.prototype.writeFloatBE=function(n,t,i){return ft(this,n,t,!1,i)};t.prototype.writeDoubleLE=function(n,t,i){return et(this,n,t,!0,i)};t.prototype.writeDoubleBE=function(n,t,i){return et(this,n,t,!1,i)};t.prototype.copy=function(n,i,r,u){var e,f;if(!t.isBuffer(n))throw new TypeError("argument should be a Buffer");if((r||(r=0),u||0===u||(u=this.length),i>=n.length&&(i=n.length),i||(i=0),u>0&&u<r&&(u=r),u===r)||0===n.length||0===this.length)return 0;if(i<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(u<0)throw new RangeError("sourceEnd out of bounds");if(u>this.length&&(u=this.length),n.length-i<u-r&&(u=n.length-i+r),e=u-r,this===n&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(i,r,u);else if(this===n&&r<i&&i<u)for(f=e-1;f>=0;--f)n[f+i]=this[f+r];else Uint8Array.prototype.set.call(n,this.subarray(r,u),i);return e};t.prototype.fill=function(n,i,r,u){var e,f,o,s;if("string"==typeof n){if("string"==typeof i?(u=i,i=0,r=this.length):"string"==typeof r&&(u=r,r=this.length),void 0!==u&&"string"!=typeof u)throw new TypeError("encoding must be a string");if("string"==typeof u&&!t.isEncoding(u))throw new TypeError("Unknown encoding: "+u);1===n.length&&(e=n.charCodeAt(0),("utf8"===u&&e<128||"latin1"===u)&&(n=e))}else"number"==typeof n&&(n&=255);if(i<0||this.length<i||this.length<r)throw new RangeError("Out of range index");if(r<=i)return this;if(i>>>=0,r=void 0===r?this.length:r>>>0,n||(n=0),"number"==typeof n)for(f=i;f<r;++f)this[f]=n;else{if(o=t.isBuffer(n)?n:t.from(n,u),s=o.length,0===s)throw new TypeError('The value "'+n+'" is invalid for argument "value"');for(f=0;f<r-i;++f)this[f+i]=o[f%s]}return this};ot=/[^+/0-9A-Za-z-_]/g}).call(this)}).call(this,n("buffer").Buffer)},{"base64-js":34,buffer:35,ieee754:36}],36:[function(n,t,i){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
i.read=function(n,t,i,r,u){var f,o,l=8*u-r-1,a=(1<<l)-1,v=a>>1,e=-7,s=i?u-1:0,c=i?-1:1,h=n[t+s];for(s+=c,f=h&(1<<-e)-1,h>>=-e,e+=l;e>0;f=256*f+n[t+s],s+=c,e-=8);for(o=f&(1<<-e)-1,f>>=-e,e+=r;e>0;o=256*o+n[t+s],s+=c,e-=8);if(0===f)f=1-v;else{if(f===a)return o?NaN:1/0*(h?-1:1);o+=Math.pow(2,r);f-=v}return(h?-1:1)*o*Math.pow(2,f-r)};i.write=function(n,t,i,r,u,f){var e,o,s,l=8*f-u-1,a=(1<<l)-1,h=a>>1,y=23===u?Math.pow(2,-24)-Math.pow(2,-77):0,c=r?0:f-1,v=r?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,e=a):(e=Math.floor(Math.log(t)/Math.LN2),t*(s=Math.pow(2,-e))<1&&(e--,s*=2),(t+=e+h>=1?y/s:y*Math.pow(2,1-h))*s>=2&&(e++,s/=2),e+h>=a?(o=0,e=a):e+h>=1?(o=(t*s-1)*Math.pow(2,u),e+=h):(o=t*Math.pow(2,h-1)*Math.pow(2,u),e=0));u>=8;n[i+c]=255&o,c+=v,o/=256,u-=8);for(e=e<<u|o,l+=u;l>0;n[i+c]=255&e,c+=v,e/=256,l-=8);n[i+c-v]|=128*p}},{}],37:[function(n,t){function c(){throw new Error("setTimeout has not been defined");}function l(){throw new Error("clearTimeout has not been defined");}function a(n){if(r===setTimeout)return setTimeout(n,0);if((r===c||!r)&&setTimeout)return r=setTimeout,setTimeout(n,0);try{return r(n,0)}catch(t){try{return r.call(null,n,0)}catch(t){return r.call(this,n,0)}}}function p(){s&&o&&(s=!1,o.length?f=o.concat(f):h=-1,f.length&&v())}function v(){var t,n;if(!s){for(t=a(p),s=!0,n=f.length;n;){for(o=f,f=[];++h<n;)o&&o[h].run();h=-1;n=f.length}o=null;s=!1,function(n){if(u===clearTimeout)return clearTimeout(n);if((u===l||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(n);try{u(n)}catch(t){try{return u.call(null,n)}catch(t){return u.call(this,n)}}}(t)}}function y(n,t){this.fun=n;this.array=t}function e(){}var r,u,i=t.exports={};!function(){try{r="function"==typeof setTimeout?setTimeout:c}catch(n){r=c}try{u="function"==typeof clearTimeout?clearTimeout:l}catch(n){u=l}}();var o,f=[],s=!1,h=-1;i.nextTick=function(n){var i=new Array(arguments.length-1),t;if(arguments.length>1)for(t=1;t<arguments.length;t++)i[t-1]=arguments[t];f.push(new y(n,i));1!==f.length||s||a(v)};y.prototype.run=function(){this.fun.apply(null,this.array)};i.title="browser";i.browser=!0;i.env={};i.argv=[];i.version="";i.versions={};i.on=e;i.addListener=e;i.once=e;i.off=e;i.removeListener=e;i.removeAllListeners=e;i.emit=e;i.prependListener=e;i.prependOnceListener=e;i.listeners=function(){return[]};i.binding=function(){throw new Error("process.binding is not supported");};i.cwd=function(){return"/"};i.chdir=function(){throw new Error("process.chdir is not supported");};i.umask=function(){return 0}},{}]},{},[26]);